{% extends "base.html" %}
{% block title %}{{ doc.title }} ¬∑ Vault{% endblock %}
{% set active = 'vault' %}

{% block content %}
<style>
  .document-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }
  
  .document-header {
    background: var(--card);
    border: 1px solid var(--line);
    border-radius: 10px;
    padding: 24px;
    margin-bottom: 24px;
  }
  
  .document-title {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }
  
  .document-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    color: var(--text-muted);
    font-size: 13px;
  }
  
  .meta-item {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .document-content {
    background: var(--card);
    border: 1px solid var(--line);
    border-radius: 10px;
    padding: 24px;
    margin-bottom: 24px;
  }
  
  .content-text {
    white-space: pre-wrap;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 14px;
    line-height: 1.6;
    color: var(--text);
  }
  
  .code-content {
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--line);
    border-radius: 6px;
    padding: 16px;
    overflow-x: auto;
  }
  
  .document-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 16px;
  }
  
  .tag {
    display: inline-block;
    padding: 4px 10px;
    background: rgba(110,168,255,0.1);
    border: 1px solid rgba(110,168,255,0.3);
    border-radius: 16px;
    color: var(--primary);
    font-size: 12px;
    text-decoration: none;
  }
  
  .tag:hover {
    background: rgba(110,168,255,0.2);
  }
  
  .document-actions {
    display: flex;
    gap: 12px;
    padding: 16px 0;
    border-top: 1px solid var(--line);
    margin-top: 16px;
  }
  
  .action-btn {
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    border: none;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  
  .btn-edit {
    background: var(--primary);
    color: white;
  }
  
  .btn-edit:hover {
    background: var(--primary-700);
  }
  
  .btn-download {
    background: var(--success);
    color: white;
  }
  
  .btn-download:hover {
    opacity: 0.9;
  }
  
  .btn-pin {
    background: transparent;
    color: var(--text);
    border: 1px solid var(--line);
  }
  
  .btn-pin:hover {
    background: rgba(251,191,36,0.1);
    border-color: #fbbf24;
    color: #fbbf24;
  }
  
  .btn-pin.pinned {
    background: rgba(251,191,36,0.1);
    border-color: #fbbf24;
    color: #fbbf24;
  }
  
  .btn-delete {
    background: transparent;
    color: var(--danger);
    border: 1px solid var(--danger);
  }
  
  .btn-delete:hover {
    background: var(--danger);
    color: white;
  }
  
  .file-preview {
    background: rgba(0,0,0,0.2);
    border: 1px solid var(--line);
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    margin: 20px 0;
  }
  
  .file-icon-large {
    font-size: 48px;
    margin-bottom: 12px;
  }
  
  .file-info {
    color: var(--text-muted);
    font-size: 13px;
  }
  
  .related-section {
    background: var(--card);
    border: 1px solid var(--line);
    border-radius: 10px;
    padding: 20px;
  }
  
  .related-list {
    display: grid;
    gap: 12px;
    margin-top: 12px;
  }
  
  .related-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    background: rgba(0,0,0,0.2);
    border: 1px solid var(--line);
    border-radius: 6px;
    text-decoration: none;
    color: var(--text);
    transition: all 0.2s;
  }
  
  .related-item:hover {
    background: rgba(110,168,255,0.1);
    border-color: var(--primary);
  }
  
  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 20px;
    color: var(--text-muted);
    font-size: 14px;
  }
  
  .breadcrumb a {
    color: var(--text-muted);
    text-decoration: none;
  }
  
  .breadcrumb a:hover {
    color: var(--primary);
  }
</style>

<div class="document-container">
  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <a href="{{ url_for('vault.index') }}">üìÅ Vault</a>
    <span>‚Ä∫</span>
    {% if doc.folder %}
      <a href="{{ url_for('vault.search', folder=doc.folder.id) }}">{{ doc.folder.icon }} {{ doc.folder.name }}</a>
      <span>‚Ä∫</span>
    {% endif %}
    <span>{{ doc.title }}</span>
  </div>
  
  <!-- Document Header -->
  <div class="document-header">
    <div class="document-title">
      <span style="font-size: 32px;">{{ file_icon }}</span>
      <h1 style="margin: 0; font-size: 24px; color: var(--text);">{{ doc.title }}</h1>
      {% if doc.pinned %}
        <span style="color: #fbbf24; font-size: 20px;">üìå</span>
      {% endif %}
    </div>
    
    <div class="document-meta">
      <div class="meta-item">
        <span>üìÖ</span>
        <span>Created: {{ doc.created_at.strftime('%B %d, %Y') }}</span>
      </div>
      <div class="meta-item">
        <span>üîÑ</span>
        <span>Updated: {{ doc.updated_at|time_ago }}</span>
      </div>
      <div class="meta-item">
        <span>üëÅÔ∏è</span>
        <span>Accessed: {{ doc.accessed_at|time_ago }}</span>
      </div>
      {% if doc.file_size %}
      <div class="meta-item">
        <span>üìä</span>
        <span>Size: {{ (doc.file_size / 1024)|round(2) }} KB</span>
      </div>
      {% endif %}
      {% if doc.versions %}
      <div class="meta-item">
        <span>üìö</span>
        <span>{{ doc.versions|length }} versions</span>
      </div>
      {% endif %}
    </div>
    
    {% if doc.tags %}
    <div class="document-tags">
      {% for tag in doc.tags %}
        <a href="{{ url_for('vault.search', tag=tag.name) }}" class="tag">
          #{{ tag.name }}
        </a>
      {% endfor %}
    </div>
    {% endif %}
    
    <div class="document-actions">
      <a href="{{ url_for('vault.edit_document', id=doc.id) }}" class="action-btn btn-edit">
        ‚úèÔ∏è Edit
      </a>
      
      {% if doc.file_path %}
      <a href="{{ url_for('vault.download_file', id=doc.id) }}" class="action-btn btn-download">
        üì• Download
      </a>
      {% endif %}
      
      <button onclick="togglePin({{ doc.id }})" class="action-btn btn-pin {% if doc.pinned %}pinned{% endif %}" id="pin-btn">
        üìå {% if doc.pinned %}Unpin{% else %}Pin{% endif %}
      </button>
      
      <form method="POST" action="{{ url_for('vault.archive_document', id=doc.id) }}" style="display: inline;">
        <button type="submit" class="action-btn" style="background: transparent; border: 1px solid var(--line); color: var(--text);">
          üì¶ Archive
        </button>
      </form>
      
      <form method="POST" action="{{ url_for('vault.delete_document', id=doc.id) }}" 
            style="display: inline;" 
            onsubmit="return confirm('Are you sure you want to delete this document? This cannot be undone.');">
        <button type="submit" class="action-btn btn-delete">
          üóëÔ∏è Delete
        </button>
      </form>
    </div>
  </div>
  
  <!-- Document Content -->
  <div class="document-content">
    {% if doc.content %}
      {% if doc.doc_type in ['code', 'script', 'config'] %}
        <div class="code-content">
          <pre class="content-text">{{ doc.content }}</pre>
        </div>
      {% else %}
        <div class="content-text">{{ doc.content }}</div>
      {% endif %}
    {% endif %}
    
    {% if doc.file_path and not doc.content %}
      <div class="file-preview">
        <div class="file-icon-large">{{ file_icon }}</div>
        <h3 style="margin: 0 0 8px 0; color: var(--text);">{{ doc.file_name }}</h3>
        <div class="file-info">
          Type: {{ doc.mime_type or 'Unknown' }}<br>
          Size: {{ (doc.file_size / 1024)|round(2) }} KB
        </div>
        <a href="{{ url_for('vault.download_file', id=doc.id) }}" class="action-btn btn-download" style="margin-top: 16px;">
          üì• Download File
        </a>
      </div>
    {% endif %}
    
    {% if not doc.content and not doc.file_path %}
      <div style="text-align: center; padding: 40px; color: var(--text-muted);">
        <div style="font-size: 48px; margin-bottom: 12px;">üìÑ</div>
        <p>No content available</p>
        <a href="{{ url_for('vault.edit_document', id=doc.id) }}" class="action-btn btn-edit" style="margin-top: 12px;">
          Add Content
        </a>
      </div>
    {% endif %}
  </div>
  
  <!-- Related Documents -->
  {% if related %}
  <div class="related-section">
    <h3 style="margin: 0 0 12px 0; font-size: 16px; color: var(--text);">
      üìÇ Related Documents
    </h3>
    <div class="related-list">
      {% for rel_doc in related %}
      <a href="{{ url_for('vault.view_document', id=rel_doc.id) }}" class="related-item">
        <span style="font-size: 20px;">{{ rel_doc.doc_type|file_icon }}</span>
        <div style="flex: 1;">
          <div style="font-weight: 500;">{{ rel_doc.title }}</div>
          <div style="font-size: 11px; color: var(--text-muted);">
            Updated {{ rel_doc.updated_at|time_ago }}
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
  </div>
  {% endif %}
</div>

<script>
function togglePin(docId) {
  fetch(`/vault/document/${docId}/pin`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    }
  })
  .then(response => response.json())
  .then(data => {
    const btn = document.getElementById('pin-btn');
    if (data.pinned) {
      btn.classList.add('pinned');
      btn.innerHTML = 'üìå Unpin';
    } else {
      btn.classList.remove('pinned');
      btn.innerHTML = 'üìå Pin';
    }
  });
}

// Syntax highlighting for code blocks (optional - you can add Prism.js or highlight.js)
document.addEventListener('DOMContentLoaded', function() {
  const codeContent = document.querySelector('.code-content pre');
  if (codeContent) {
    // Basic syntax highlighting could go here
    // For now, just ensure proper formatting
  }
});
</script>
{% endblock %}