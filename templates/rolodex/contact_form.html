{% extends "base.html" %}
{% block title %}{{ 'New Contact' if mode=='new' else 'Edit Contact' }} Â· Rolodex{% endblock %}

{% block head %}
<style>
  .contact-form-container * {
    box-sizing: border-box !important;
  }
  
  .contact-form-container input,
  .contact-form-container select,
  .contact-form-container textarea {
    min-width: 0 !important;
    width: 100% !important;
    transition: all 0.3s ease;
  }
  
  .contact-form-container input:focus,
  .contact-form-container select:focus,
  .contact-form-container textarea:focus {
    border-color: #3b82f6 !important;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
  }
  
  .form-section {
    transition: transform 0.2s ease;
  }
  
  .form-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  }
  
  .badge-required {
    color: #ef4444;
    font-weight: normal;
  }
  
  .file-upload-area {
    border: 2px dashed var(--line);
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
  }
  
  .file-upload-area:hover {
    border-color: #3b82f6;
    background: rgba(59, 130, 246, 0.05);
  }
</style>
{% endblock %}

{% block content %}
<div class="contact-form-container" style="max-width: 1200px; margin: 0 auto; padding: 20px;">
  <!-- Header -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid var(--line);">
    <div>
      <h1 style="margin: 0; color: var(--text); font-size: 32px;">
        {{ 'âœ¨ New Contact' if mode=='new' else 'âœï¸ Edit Contact' }}
      </h1>
      <p style="margin: 5px 0 0 0; color: var(--text-muted);">
        {{ 'Add a new person to your network' if mode=='new' else 'Update contact information' }}
      </p>
    </div>
    <a href="{{ url_for('rolodex.contacts') }}" 
       style="display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; background: #374151; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.2s ease;"
       onmouseover="this.style.background='#4b5563'; this.style.transform='translateY(-1px)'"
       onmouseout="this.style.background='#374151'; this.style.transform='translateY(0)'">
      â† Back to Contacts
    </a>
  </div>

  {% if dedupe %}
  <div style="background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000; padding: 15px 20px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
    <span style="font-size: 20px;">âš ï¸</span>
    <strong>Possible duplicate detected.</strong> Submit again to confirm, or go back to check existing contacts.
  </div>
  {% endif %}

  <form method="POST" enctype="multipart/form-data">
    {% if dedupe %}<input type="hidden" name="dedupe_override" value="1">{% endif %}
    
    <!-- Basic Information -->
    <div class="form-section" style="background: var(--card); border: 1px solid var(--line); border-radius: 12px; margin-bottom: 20px; overflow: hidden;">
      <h3 style="background: linear-gradient(135deg, rgba(110,168,255,0.1), transparent); padding: 16px 24px; margin: 0; border-bottom: 1px solid var(--line); font-size: 18px;">
        <span style="margin-right: 8px; font-size: 18px;">ğŸ‘¤</span>Basic Information
      </h3>
      <div style="padding: 24px;">
        
        <!-- Photo uploads row -->
        <div style="display: flex; gap: 20px; margin-bottom: 25px;">
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 10px; color: var(--text); font-weight: 600;">
              ğŸ“· Profile Photo
            </label>
            {% if mode=='edit' and contact.profile_photo %}
              <div style="margin-bottom: 10px;">
                <img src="{{ url_for('static', filename='contact_photos/' + contact.profile_photo) }}" 
                     style="width: 120px; height: 120px; object-fit: cover; border-radius: 10px; border: 2px solid var(--line);">
              </div>
            {% endif %}
            <div class="file-upload-area">
              <input type="file" name="profile_photo" accept="image/*" id="profile_photo" style="display: none;">
              <label for="profile_photo" style="cursor: pointer;">
                <div>ğŸ“¸ Click to upload photo</div>
                <small style="color: var(--text-muted);">JPG, PNG, GIF (max 5MB)</small>
              </label>
            </div>
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 10px; color: var(--text); font-weight: 600;">
              ğŸ’¼ Business Card
            </label>
            {% if mode=='edit' and contact.business_card_photo %}
              <div style="margin-bottom: 10px;">
                <img src="{{ url_for('static', filename='contact_photos/' + contact.business_card_photo) }}" 
                     style="width: 120px; height: 120px; object-fit: cover; border-radius: 10px; border: 2px solid var(--line);">
              </div>
            {% endif %}
            <div class="file-upload-area">
              <input type="file" name="business_card_photo" accept="image/*" id="business_card" style="display: none;">
              <label for="business_card" style="cursor: pointer;">
                <div>ğŸ´ Click to upload card</div>
                <small style="color: var(--text-muted);">Scan or photo of business card</small>
              </label>
            </div>
          </div>
        </div>

        <!-- Name fields row -->
        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">First Name</label>
            <input type="text" name="first_name" value="{{ form.get('first_name','') }}" placeholder="John"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">Last Name</label>
            <input type="text" name="last_name" value="{{ form.get('last_name','') }}" placeholder="Doe"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">
              Display Name <span class="badge-required">*</span>
            </label>
            <input type="text" name="display_name" required value="{{ form.get('display_name', contact.display_name if contact else '') }}" 
                   placeholder="How you'll see this contact"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
        </div>

        <!-- Title and Company row -->
        <div style="display: flex; gap: 15px;">
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">Title/Role</label>
            <input type="text" name="title" value="{{ form.get('title', contact.title if contact else '') }}" placeholder="CEO, Developer, etc."
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">Company</label>
            <select name="company_id" style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
              <option value="">â€” Select Company â€”</option>
              {% for co in companies %}
                <option value="{{ co.id }}" {% if (contact and contact.company_id == co.id) %}selected{% endif %}>
                  {{ co.name }}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Contact Information -->
    <div class="form-section" style="background: var(--card); border: 1px solid var(--line); border-radius: 12px; margin-bottom: 20px; overflow: hidden;">
      <h3 style="background: linear-gradient(135deg, rgba(110,168,255,0.1), transparent); padding: 16px 24px; margin: 0; border-bottom: 1px solid var(--line); font-size: 18px;">
        <span style="margin-right: 8px; font-size: 18px;">ğŸ“</span>Contact Methods
      </h3>
      <div style="padding: 24px;">
        
        <!-- Email and phones row 1 -->
        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ“§ Primary Email</label>
            <input type="email" name="email" value="{{ form.get('email', contact.email if contact else '') }}" placeholder="john@example.com"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">â˜ï¸ Primary Phone</label>
            <input type="tel" name="phone" value="{{ form.get('phone', contact.phone if contact else '') }}" placeholder="(555) 123-4567"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ“± Mobile Phone</label>
            <input type="tel" name="mobile_phone" value="{{ form.get('mobile_phone', contact.mobile_phone if contact else '') }}" placeholder="(555) 987-6543"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
        </div>

        <!-- More phones row -->
        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ’¼ Work Phone</label>
            <input type="tel" name="work_phone" value="{{ form.get('work_phone', contact.work_phone if contact else '') }}"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ  Home Phone</label>
            <input type="tel" name="home_phone" value="{{ form.get('home_phone', contact.home_phone if contact else '') }}"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">âœ‰ï¸ Personal Email</label>
            <input type="email" name="personal_email" value="{{ form.get('personal_email', contact.personal_email if contact else '') }}"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
        </div>

        <!-- Website -->
        <div>
          <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸŒ Website</label>
          <input type="url" name="website" placeholder="https://example.com" value="{{ form.get('website', contact.website if contact else '') }}"
                 style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
        </div>
      </div>
    </div>

    <!-- Physical Address -->
    <div class="form-section" style="background: var(--card); border: 1px solid var(--line); border-radius: 12px; margin-bottom: 20px; overflow: hidden;">
      <h3 style="background: linear-gradient(135deg, rgba(110,168,255,0.1), transparent); padding: 16px 24px; margin: 0; border-bottom: 1px solid var(--line); font-size: 18px;">
        <span style="margin-right: 8px; font-size: 18px;">ğŸ“</span>Physical Address
      </h3>
      <div style="padding: 24px;">
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">Street Address</label>
          <input type="text" name="street_address" value="{{ form.get('street_address', contact.street_address if contact else '') }}" 
                 placeholder="123 Main Street"
                 style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
        </div>
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">Address Line 2</label>
          <input type="text" name="address_line_2" placeholder="Apartment, suite, etc." 
                 value="{{ form.get('address_line_2', contact.address_line_2 if contact else '') }}"
                 style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
        </div>

        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">City</label>
            <input type="text" name="city" value="{{ form.get('city', contact.city if contact else '') }}" placeholder="New York"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">State</label>
            <input type="text" name="state" value="{{ form.get('state', contact.state if contact else '') }}" placeholder="NY"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ZIP Code</label>
            <input type="text" name="zip_code" value="{{ form.get('zip_code', contact.zip_code if contact else '') }}" placeholder="10001"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">Country</label>
          <input type="text" name="country" value="{{ form.get('country', contact.country if contact else '') }}" placeholder="United States"
                 style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
        </div>
      </div>
    </div>

    <!-- Social Media -->
    <div class="form-section" style="background: var(--card); border: 1px solid var(--line); border-radius: 12px; margin-bottom: 20px; overflow: hidden;">
      <h3 style="background: linear-gradient(135deg, rgba(110,168,255,0.1), transparent); padding: 16px 24px; margin: 0; border-bottom: 1px solid var(--line); font-size: 18px;">
        <span style="margin-right: 8px; font-size: 18px;">ğŸ”—</span>Social Media
      </h3>
      <div style="padding: 24px;">
        
        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ’¼ LinkedIn</label>
            <input type="url" name="linkedin_url" placeholder="https://linkedin.com/in/username" 
                   value="{{ form.get('linkedin_url', contact.linkedin_url if contact else '') }}"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ¦ Twitter/X</label>
            <input type="url" name="twitter_url" placeholder="https://twitter.com/username" 
                   value="{{ form.get('twitter_url', contact.twitter_url if contact else '') }}"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
        </div>

        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ“˜ Facebook</label>
            <input type="url" name="facebook_url" placeholder="https://facebook.com/username" 
                   value="{{ form.get('facebook_url', contact.facebook_url if contact else '') }}"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ“· Instagram</label>
            <input type="url" name="instagram_url" placeholder="https://instagram.com/username" 
                   value="{{ form.get('instagram_url', contact.instagram_url if contact else '') }}"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
        </div>

        <div>
          <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ’» GitHub</label>
          <input type="url" name="github_url" placeholder="https://github.com/username" 
                 value="{{ form.get('github_url', contact.github_url if contact else '') }}"
                 style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
        </div>
      </div>
    </div>

    <!-- Personal Information -->
    <div class="form-section" style="background: var(--card); border: 1px solid var(--line); border-radius: 12px; margin-bottom: 20px; overflow: hidden;">
      <h3 style="background: linear-gradient(135deg, rgba(110,168,255,0.1), transparent); padding: 16px 24px; margin: 0; border-bottom: 1px solid var(--line); font-size: 18px;">
        <span style="margin-right: 8px; font-size: 18px;">â¤ï¸</span>Personal Information
      </h3>
      <div style="padding: 24px;">
        
        <div style="display: flex; gap: 15px; margin-bottom: 20px;">
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ‚ Birthday</label>
            <input type="date" name="birthday" 
                   value="{{ form.get('birthday', contact.birthday.strftime('%Y-%m-%d') if contact and contact.birthday else '') }}"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ’ Anniversary</label>
            <input type="date" name="anniversary" 
                   value="{{ form.get('anniversary', contact.anniversary.strftime('%Y-%m-%d') if contact and contact.anniversary else '') }}"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
        </div>

        <div style="display: flex; gap: 15px;">
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ’‘ Spouse/Partner</label>
            <input type="text" name="spouse_name" value="{{ form.get('spouse_name', contact.spouse_name if contact else '') }}"
                   placeholder="Partner's name"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Children</label>
            <input type="text" name="children_names" placeholder="Emma, Jack (comma separated)" 
                   value="{{ form.get('children_names', contact.children_names if contact else '') }}"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
          
          <div style="flex: 1;">
            <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ‘” Assistant</label>
            <input type="text" name="assistant_name" value="{{ form.get('assistant_name', contact.assistant_name if contact else '') }}"
                   placeholder="Assistant's name"
                   style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          </div>
        </div>
      </div>
    </div>

    <!-- Organization -->
    <div class="form-section" style="background: var(--card); border: 1px solid var(--line); border-radius: 12px; margin-bottom: 20px; overflow: hidden;">
      <h3 style="background: linear-gradient(135deg, rgba(110,168,255,0.1), transparent); padding: 16px 24px; margin: 0; border-bottom: 1px solid var(--line); font-size: 18px;">
        <span style="margin-right: 8px; font-size: 18px;">ğŸ·ï¸</span>Organization & Notes
      </h3>
      <div style="padding: 24px;">
        
        <div style="margin-bottom: 20px;">
          <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">Tags</label>
          <input type="text" name="tags" placeholder="client, vendor, friend, vip (comma-separated)" 
                 value="{{ form.get('tags', contact.tags if contact else '') }}"
                 style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text);">
          <small style="color: var(--text-muted); margin-top: 5px; display: block;">Use tags to organize and quickly find contacts</small>
        </div>
        
        <div>
          <label style="display: block; margin-bottom: 8px; color: var(--text); font-weight: 600;">ğŸ“ Notes</label>
          <textarea name="notes" rows="6" placeholder="Important details, preferences, how you met, etc..."
                    style="width: 100%; padding: 12px; background: #0c1322; border: 2px solid var(--line); border-radius: 8px; color: var(--text); resize: vertical;">{{ form.get('notes', contact.notes if contact else '') }}</textarea>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div style="display: flex; gap: 12px; justify-content: center; margin-top: 40px; padding: 30px; background: var(--card); border-radius: 12px; border: 1px solid var(--line);">
      <button type="submit" 
              style="display: inline-flex; align-items: center; gap: 8px; padding: 14px 32px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s ease;"
              onmouseover="this.style.background='#2563eb'; this.style.transform='translateY(-1px)'; this.style.boxShadow='0 10px 20px rgba(59, 130, 246, 0.3)'"
              onmouseout="this.style.background='#3b82f6'; this.style.transform='translateY(0)'; this.style.boxShadow='none'">
        ğŸ’¾ Save Contact
      </button>
      <a href="{{ url_for('rolodex.contacts') }}" 
         style="display: inline-flex; align-items: center; gap: 8px; padding: 14px 32px; background: #374151; color: white; text-decoration: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s ease;"
         onmouseover="this.style.background='#4b5563'; this.style.transform='translateY(-1px)'"
         onmouseout="this.style.background='#374151'; this.style.transform='translateY(0)'">
        Cancel
      </a>
    </div>
  </form>
</div>
{% endblock %}