{% extends "base.html" %}
{% block title %}Contacts · Rolodex{% endblock %}

{% block content %}
<style>
  /* Override the massive avatar problem */
  td img {
    width: 40px !important;
    height: 40px !important;
    max-width: 40px !important;
    max-height: 40px !important;
    border-radius: 50% !important;
    object-fit: cover !important;
  }
</style>

<div style="padding: 20px;">
  <!-- Header -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
    <div>
      <h1 style="margin: 0; font-size: 24px;">📋 Rolodex</h1>
      <p style="margin: 4px 0 0 0; color: var(--text-muted); font-size: 14px;">Manage your professional network</p>
    </div>
    <div>
      <a href="{{ url_for('rolodex.contact_new') }}" style="padding: 8px 16px; background: var(--primary); color: white; text-decoration: none; border-radius: 6px; margin-right: 8px;">+ New Contact</a>
      <a href="{{ url_for('rolodex.company_new') }}" style="padding: 8px 16px; background: var(--success); color: white; text-decoration: none; border-radius: 6px;">+ New Company</a>
        <a href="{{ url_for('rolodex.rolodex_import') }}" 
     style="padding: 8px 16px; background: var(--info); color: white; text-decoration: none; border-radius: 6px;">
    ⬆️ Import
  </a>
    </div>
  </div>

  <!-- Tabs -->
  <div style="display: flex; gap: 4px; margin-bottom: 20px; background: var(--card); border: 1px solid var(--line); border-radius: 8px; padding: 4px;">
    <a href="{{ url_for('rolodex.contacts') }}" style="flex: 1; padding: 8px; text-align: center; background: var(--primary); color: white; text-decoration: none; border-radius: 4px;">👥 Contacts</a>
    <a href="{{ url_for('rolodex.companies') }}" style="flex: 1; padding: 8px; text-align: center; color: var(--text); text-decoration: none;">🏢 Companies</a>
  </div>

  <!-- Quick Stats -->
  <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px;">
    <div style="background: var(--card); border: 1px solid var(--line); padding: 12px; border-radius: 6px; text-align: center;">
      <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Total</div>
      <div style="font-size: 20px; font-weight: bold;">{{ contacts.total }}</div>
    </div>
    <div style="background: var(--card); border: 1px solid var(--line); padding: 12px; border-radius: 6px; text-align: center;">
      <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Active</div>
      <div style="font-size: 20px; font-weight: bold; color: var(--success);">{{ contacts.total }}</div>
    </div>
    <div style="background: var(--card); border: 1px solid var(--line); padding: 12px; border-radius: 6px; text-align: center;">
      <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Companies</div>
      <div style="font-size: 20px; font-weight: bold;">{{ total_companies_all }}</div>
    </div>
    <div style="background: var(--card); border: 1px solid var(--line); padding: 12px; border-radius: 6px; text-align: center;">
      <div style="font-size: 11px; color: var(--text-muted); text-transform: uppercase;">Page</div>
      <div style="font-size: 20px; font-weight: bold;">{{ contacts.page }}/{{ contacts.pages or 1 }}</div>
    </div>
  </div>

  <!-- Search -->
  <form method="get" style="display: flex; gap: 10px; margin-bottom: 20px; background: var(--card); padding: 12px; border: 1px solid var(--line); border-radius: 8px;">
    <input type="text" name="q" value="{{ q or '' }}" placeholder="Search..." style="flex: 1; padding: 6px 10px; background: var(--bg); border: 1px solid var(--line); border-radius: 4px; color: var(--text);">
    <select name="sort" style="padding: 6px 10px; background: var(--bg); border: 1px solid var(--line); border-radius: 4px; color: var(--text);">
      <option value="name_asc" {% if sort=='name_asc' %}selected{% endif %}>Name A→Z</option>
      <option value="name_desc" {% if sort=='name_desc' %}selected{% endif %}>Name Z→A</option>
      <option value="updated_desc" {% if sort=='updated_desc' %}selected{% endif %}>Recently Updated</option>
    </select>
    <label style="display: flex; align-items: center; gap: 4px;">
      <input type="checkbox" name="archived" value="1" {% if show_archived %}checked{% endif %}>
      <span>Show Archived</span>
    </label>
    <button type="submit" style="padding: 6px 14px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">Search</button>
  </form>

  <!-- Table -->
  {% if contacts.items %}
  <div style="background: var(--card); border: 1px solid var(--line); border-radius: 8px; overflow: hidden;">
    <table style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr style="background: rgba(255,255,255,0.02); border-bottom: 1px solid var(--line);">
          <th style="padding: 10px; text-align: left; font-size: 11px; text-transform: uppercase; width: 50px;"></th>
          <th style="padding: 10px; text-align: left; font-size: 11px; text-transform: uppercase;">Name</th>
          <th style="padding: 10px; text-align: left; font-size: 11px; text-transform: uppercase;">Company</th>
          <th style="padding: 10px; text-align: left; font-size: 11px; text-transform: uppercase;">Contact</th>
          <th style="padding: 10px; text-align: left; font-size: 11px; text-transform: uppercase;">Tags</th>
          <th style="padding: 10px; text-align: left; font-size: 11px; text-transform: uppercase;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for contact in contacts.items %}
        <tr style="border-bottom: 1px solid rgba(255,255,255,0.02);">
          <td style="padding: 8px 10px;">
            {% if contact.profile_photo %}
              <img src="{{ url_for('static', filename='contact_photos/' + contact.profile_photo) }}" alt="{{ contact.display_name }}">
            {% else %}
              <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;">
                {{ contact.display_name[0]|upper if contact.display_name else '?' }}
              </div>
            {% endif %}
          </td>
          
          <td style="padding: 8px 10px;">
            <a href="{{ url_for('rolodex.contact_detail', id=contact.id) }}" style="color: var(--primary); text-decoration: none; font-weight: 500;">
              {{ contact.display_name }}
            </a>
            {% if contact.title %}
              <div style="font-size: 12px; color: var(--text-muted);">{{ contact.title }}</div>
            {% endif %}
          </td>
          
          <td style="padding: 8px 10px;">
            {% if contact.company_id and contact.company_id in companies_map %}
              <a href="{{ url_for('rolodex.company_detail', id=contact.company_id) }}" style="color: var(--success); text-decoration: none;">
                🏢 {{ companies_map[contact.company_id].name }}
              </a>
            {% else %}
              —
            {% endif %}
          </td>
          
          <td style="padding: 8px 10px; font-size: 13px;">
            {% if contact.email %}
              <div><a href="mailto:{{ contact.email }}" style="color: var(--text-muted); text-decoration: none;">📧 {{ contact.email }}</a></div>
            {% endif %}
            {% if contact.phone %}
              <div><a href="tel:{{ contact.phone }}" style="color: var(--text-muted); text-decoration: none;">📱 {{ contact.phone }}</a></div>
            {% endif %}
          </td>
          
          <td style="padding: 8px 10px;">
            {% if contact.tags %}
              {% for tag in contact.tags.split(',')[:2] %}
                <span style="display: inline-block; padding: 2px 6px; background: rgba(139,92,246,0.2); color: #a78bfa; border-radius: 4px; font-size: 11px; margin-right: 2px;">
                  {{ tag.strip() }}
                </span>
              {% endfor %}
            {% else %}
              —
            {% endif %}
          </td>
          
          <td style="padding: 8px 10px;">
            <a href="{{ url_for('rolodex.contact_detail', id=contact.id) }}" style="padding: 4px 8px; background: var(--primary); color: white; text-decoration: none; border-radius: 4px; font-size: 12px; margin-right: 4px;">View</a>
            <a href="{{ url_for('rolodex.contact_edit', id=contact.id) }}" style="padding: 4px 8px; background: var(--panel); color: var(--text); text-decoration: none; border-radius: 4px; font-size: 12px;">Edit</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  {% if contacts.pages > 1 %}
  <div style="display: flex; justify-content: center; align-items: center; gap: 12px; margin-top: 20px;">
    {% if contacts.has_prev %}
      <a href="{{ url_for('rolodex.contacts', q=q, sort=sort, archived=1 if show_archived else None, page=contacts.prev_num) }}" 
         style="padding: 6px 12px; background: var(--card); color: var(--text); text-decoration: none; border: 1px solid var(--line); border-radius: 4px;">
        ← Previous
      </a>
    {% endif %}
    
    <span>Page {{ contacts.page }} of {{ contacts.pages }}</span>
    
    {% if contacts.has_next %}
      <a href="{{ url_for('rolodex.contacts', q=q, sort=sort, archived=1 if show_archived else None, page=contacts.next_num) }}"
         style="padding: 6px 12px; background: var(--card); color: var(--text); text-decoration: none; border: 1px solid var(--line); border-radius: 4px;">
        Next →
      </a>
    {% endif %}
  </div>
  {% endif %}

  {% else %}
  <!-- Empty State -->
  <div style="text-align: center; padding: 60px; background: var(--card); border: 1px solid var(--line); border-radius: 8px;">
    <div style="font-size: 48px;">👥</div>
    <h2>No contacts found</h2>
    <p style="color: var(--text-muted);">Start building your network</p>
    <a href="{{ url_for('rolodex.contact_new') }}" style="padding: 8px 16px; background: var(--primary); color: white; text-decoration: none; border-radius: 6px;">Add First Contact</a>
  </div>
  {% endif %}
</div>
{% endblock %}