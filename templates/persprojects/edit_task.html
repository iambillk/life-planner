{% extends "base.html" %}
{% block title %}Edit Task - {{ project.name }}{% endblock %}
{% block header %}Edit Task{% endblock %}

{% block extra_css %}
<style>
  :root {
    --et-bg: var(--bg, #0b0f1a);
    --et-card: var(--card, #0f1625);
    --et-line: var(--line, #1f2a3d);
    --et-text: var(--text, #e6eaf2);
    --et-muted: var(--text-muted, #9fb0c8);
    --et-primary: var(--primary, #6ea8ff);
    --et-success: var(--success, #22c55e);
    --et-danger: var(--danger, #ef4444);
    --et-radius: 14px;
  }

  .edit-task-container {
    max-width: 700px;
    margin: 0 auto;
    padding: 20px;
  }

  .project-context {
    background: var(--et-card);
    border: 1px solid var(--et-line);
    border-radius: var(--et-radius);
    padding: 12px;
    margin-bottom: 20px;
    color: var(--et-muted);
  }

  .project-context strong {
    color: var(--et-text);
  }

  .task-form {
    background: var(--et-card);
    border: 1px solid var(--et-line);
    border-radius: var(--et-radius);
    padding: 20px;
  }

  .form-section {
    margin-bottom: 25px;
  }

  .form-section h3 {
    margin-bottom: 15px;
    color: var(--et-text);
    font-size: 1.1rem;
  }

  .form-group {
    margin-bottom: 15px;
  }

  .form-group label {
    display: block;
    margin-bottom: 6px;
    color: var(--et-muted);
    font-weight: 600;
  }

  .form-control {
    width: 100%;
    background: #0b1120;
    color: var(--et-text);
    border: 1px solid var(--et-line);
    border-radius: 10px;
    padding: 10px 12px;
    font-size: 0.95rem;
  }

  .form-control:focus {
    outline: none;
    border-color: var(--et-primary);
  }

  textarea.form-control {
    resize: vertical;
    min-height: 100px;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
  }

  .priority-indicator {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-left: 8px;
  }

  .priority-low { background: #3b82f6; }
  .priority-medium { background: #f59e0b; }
  .priority-high { background: #ef4444; }

  .actions {
    display: flex;
    gap: 10px;
    justify-content: space-between;
    margin-top: 20px;
  }

  .btn {
    padding: 10px 20px;
    border-radius: 10px;
    border: 1px solid var(--et-line);
    background: var(--et-card);
    color: var(--et-text);
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s;
  }

  .btn:hover {
    border-color: var(--et-primary);
  }

  .btn-primary {
    background: var(--et-primary);
    color: #0a0f1a;
    border-color: var(--et-primary);
  }

  .btn-danger {
    background: #2a0f15;
    border-color: #7f1d1d;
    color: #fecaca;
  }

  .btn-danger:hover {
    border-color: var(--et-danger);
  }

  .current-status {
    background: #0c1322;
    border: 1px solid var(--et-line);
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 15px;
  }

  .status-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 999px;
    font-weight: 700;
    font-size: 0.8rem;
  }

  .status-badge.completed {
    background: #22c55e;
    color: #0a0f1a;
  }

  .status-badge.pending {
    background: #f59e0b;
    color: #0a0f1a;
  }
</style>
{% endblock %}

{% block content %}
<div class="edit-task-container">
  <!-- Project Context -->
  <div class="project-context">
    <strong>Project:</strong> {{ project.name }}
    {% if project.category %}
      | <strong>Category:</strong> {{ project.category }}
    {% endif %}
  </div>

  <!-- Edit Form -->
  <form method="POST" class="task-form">
    <div class="form-section">
      <h3>Task Details</h3>
      
      <!-- Current Status -->
      <div class="current-status">
        <strong>Status:</strong>
        {% if task.completed %}
          <span class="status-badge completed">‚úì Completed</span>
          {% if task.completed_at %}
            on {{ task.completed_at.strftime('%b %d, %Y') }}
          {% endif %}
        {% else %}
          <span class="status-badge pending">‚è≥ Pending</span>
        {% endif %}
      </div>

      <!-- Task Content -->
      <div class="form-group">
        <label for="content">Task Description <span style="color: var(--et-danger);">*</span></label>
        <textarea name="content" id="content" class="form-control" required>{{ task.content }}</textarea>
      </div>

      <!-- Category and Priority -->
      <div class="form-row">
        <div class="form-group">
          <label for="category">Category</label>
          <select name="category" id="category" class="form-control">
            <option value="">-- Select Category --</option>
            {% for cat in categories %}
              <option value="{{ cat }}" {% if task.category == cat %}selected{% endif %}>
                {{ cat|title }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label for="priority">
            Priority
            <span id="priority-indicator" class="priority-indicator priority-{{ task.priority or 'medium' }}"></span>
          </label>
          <select name="priority" id="priority" class="form-control" onchange="updatePriorityIndicator()">
            {% for pri in priorities %}
              <option value="{{ pri }}" {% if (task.priority or 'medium') == pri %}selected{% endif %}>
                {{ pri|title }}
              </option>
            {% endfor %}
          </select>
        </div>
      </div>

      <!-- Due Date -->
      <div class="form-group">
        <label for="due_date">Due Date</label>
        <input type="date" name="due_date" id="due_date" class="form-control" 
               value="{{ task.due_date.strftime('%Y-%m-%d') if task.due_date else '' }}">
      </div>

      <!-- Notes -->
      <div class="form-group">
        <label for="notes">Notes</label>
        <textarea name="notes" id="notes" class="form-control" rows="3" 
                  placeholder="Additional notes or details...">{{ task.notes or '' }}</textarea>
      </div>
    </div>

    <!-- Actions -->
    <div class="actions">
      <div>
        <a href="{{ url_for('persprojects.detail', id=project.id) }}" class="btn">Cancel</a>
      </div>
      <div style="display: flex; gap: 10px;">
        <button type="submit" class="btn btn-primary">Save Changes</button>
      </div>
    </div>
  </form>

  <!-- Delete Option -->
  <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--et-line);">
    <form method="POST" action="{{ url_for('persprojects.delete_task', task_id=task.id) }}" 
          onsubmit="return confirm('Are you sure you want to delete this task?');">
      <button type="submit" class="btn btn-danger">üóëÔ∏è Delete Task</button>
    </form>
  </div>
</div>

<script>
function updatePriorityIndicator() {
  const select = document.getElementById('priority');
  const indicator = document.getElementById('priority-indicator');
  indicator.className = 'priority-indicator priority-' + select.value;
}
</script>
{% endblock %}