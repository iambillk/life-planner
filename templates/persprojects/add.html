<!-- templates/persprojects/add.html - Dark theme matching TCH Add Project -->
{% extends "base.html" %}
{% block title %}Add Personal Project{% endblock %}
{% block header %}Create New Personal Project{% endblock %}

{% block extra_css %}
<style>
  /* ===========================
     Page-scoped variables (dark theme)
  ============================ */
  :root{
    --ap-bg: var(--bg, #0b0f1a);
    --ap-card: var(--card, #0f1625);
    --ap-line: var(--line, #1f2a3d);
    --ap-text: var(--text, #e6eaf2);
    --ap-muted: var(--text-muted, #9fb0c8);
    --ap-primary: var(--primary, #6ea8ff);
    --ap-primary-700: var(--primary-700, #3f7fe6);
    --ap-danger: var(--danger, #ef4444);
    --ap-radius: var(--radius, 14px);
    --ap-radius-sm: var(--radius-sm, 10px);
    --ap-shadow: 0 6px 18px rgba(0,0,0,.35);
  }

  /* ===========================
     Container + sticky actions
  ============================ */
  .form-container{
    max-width: 980px;
    margin: 0 auto;
    display: grid;
    gap: 14px;
    padding: 14px;
  }

  .form-header{
    position: sticky; top: 12px; z-index: 5;
    display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center;
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border: 1px solid var(--ap-line); border-radius: var(--ap-radius);
    padding: 10px 12px; box-shadow: var(--ap-shadow); backdrop-filter: blur(6px);
  }
  .form-header h1{ margin: 0; font-size: 1.15rem; }
  .header-actions{ display: flex; gap: 8px; flex-wrap: wrap; }

  /* Buttons */
  .btn{
    display: inline-flex; align-items: center; gap: 8px;
    padding: 8px 12px; border-radius: 12px; border: 1px solid var(--ap-line);
    background: var(--ap-card); color: var(--ap-text);
    text-decoration: none; font-size: .95rem;
    transition: transform .1s ease, border-color .2s ease, background .2s ease;
  }
  .btn:hover{ border-color: var(--ap-primary); transform: translateY(-1px); }
  .btn-primary{ background: rgba(110,168,255,.18); border-color: rgba(110,168,255,.45); }
  .btn-primary:hover{ background: rgba(110,168,255,.25); }
  .btn-primary[disabled]{ opacity: .6; cursor: wait; }
  .btn-outline{ background: transparent; }

  /* Form card */
  .project-form{
    background: var(--ap-card); border: 1px solid var(--ap-line);
    border-radius: var(--ap-radius); box-shadow: var(--ap-shadow);
    padding: 14px; display: grid; gap: 18px;
  }

  .form-section{
    border: 1px dashed var(--ap-line); border-radius: var(--ap-radius-sm);
    padding: 12px; display: grid; gap: 12px;
  }
  .form-section h2{
    margin: 0; font-size: 1.02rem; padding-bottom: 6px;
    border-bottom: 1px dashed var(--ap-line);
  }

  .form-row{ display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  @media (max-width: 820px){ .form-row{ grid-template-columns: 1fr; } }

  .form-group{ display: grid; gap: 6px; }
  .form-group label{ color: var(--ap-muted); font-weight: 600; font-size: .9rem; }
  .required{ color: var(--ap-danger); }

  /* Inputs */
  .project-form input[type="text"],
  .project-form input[type="date"],
  .project-form select,
  .project-form textarea{
    width: 100%; background: #0b1120; color: var(--ap-text);
    border: 1px solid var(--ap-line); border-radius: 10px; padding: 10px 12px;
    font-size: .95rem;
  }
  .project-form input:focus,
  .project-form select:focus,
  .project-form textarea:focus{
    outline: none; border-color: var(--ap-primary);
  }
  .project-form textarea{ resize: vertical; min-height: 80px; }
  
  /* Character counter */
  .counter{ 
    color: var(--ap-muted); font-size: .8rem; text-align: right; 
    margin-top: 2px; 
  }
  .hint{ color: var(--ap-muted); font-size: .85rem; }

  /* Action buttons */
  .form-actions{ 
    display: flex; gap: 10px; justify-content: center; 
    padding-top: 10px; 
  }

  /* Quick fill chips */
  .quick-fills{
    display: flex; gap: 6px; flex-wrap: wrap; margin-top: 6px;
  }
  .quick-chip{
    padding: 4px 10px; border-radius: 999px; font-size: .85rem;
    background: #0c1322; color: var(--ap-muted); cursor: pointer;
    border: 1px solid var(--ap-line); transition: all .2s;
  }
  .quick-chip:hover{
    border-color: var(--ap-primary); color: var(--ap-text);
  }

  /* Responsive */
  @media (max-width: 680px){
    .form-actions{ flex-direction: column; }
    .form-actions .btn{ width: 100%; justify-content: center; }
  }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
  <!-- Sticky header -->
  <div class="form-header">
    <h1>üéØ Create New Personal Project</h1>
    <div class="header-actions">
      <a href="{{ url_for('persprojects.index') }}" class="btn btn-outline">‚Üê Cancel</a>
      <button form="createProjectForm" class="btn btn-primary" id="submitBtn">
        ‚ûï Create Project
      </button>
    </div>
  </div>

  <!-- Form -->
  <form id="createProjectForm" method="POST" action="{{ url_for('persprojects.add') }}" class="project-form">
    <!-- Basic Information -->
    <div class="form-section">
      <h2>üìã Basic Information</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="name">Project Name <span class="required">*</span></label>
          <input type="text" id="name" name="name" required 
                 placeholder="Enter project name" maxlength="100">
          <div class="counter" data-for="name">0/100</div>
        </div>

        <div class="form-group">
          <label for="category">Category</label>
          <select id="category" name="category">
            <option value="">Select category...</option>
            {% for cat in categories %}
            <option value="{{ cat }}">{{ cat }}</option>
            {% endfor %}
          </select>
          <div class="hint">Organize your projects by type</div>
        </div>
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea id="description" name="description" rows="3" 
                  placeholder="Brief description of the project" maxlength="500"></textarea>
        <div class="counter" data-for="description">0/500</div>
      </div>
    </div>

    <!-- Status & Priority -->
    <div class="form-section">
      <h2>‚öôÔ∏è Status & Priority</h2>

      <div class="form-row">
        <div class="form-group">
          <label for="status">Initial Status <span class="required">*</span></label>
          <select id="status" name="status" required>
            {% for value, label in statuses %}
            <option value="{{ value }}" {% if value == 'planning' %}selected{% endif %}>
              {{ label }}
            </option>
            {% endfor %}
          </select>
          <div class="hint">Most projects start in Planning</div>
        </div>

        <div class="form-group">
          <label for="priority">Priority Level <span class="required">*</span></label>
          <select id="priority" name="priority" required>
            {% for value, label in priorities %}
            <option value="{{ value }}" {% if value == 'medium' %}selected{% endif %}>
              {{ label }}
            </option>
            {% endfor %}
          </select>
          <div class="hint">How important is this project?</div>
        </div>
      </div>

      <div class="form-group">
        <label for="deadline">Target Deadline</label>
        <input type="date" id="deadline" name="deadline">
        <div class="hint">Optional: When do you want to complete this?</div>
      </div>
    </div>

    <!-- Planning Details -->
    <div class="form-section">
      <h2>üéØ Planning Details</h2>
      <p style="color: var(--ap-muted); font-size: .9rem; margin: 0 0 10px 0;">
        Optional but recommended - clarify your vision for this project
      </p>

      <div class="form-group">
        <label for="goal">Goal - What do you want to achieve?</label>
        <textarea id="goal" name="goal" rows="2" 
                  placeholder="What's the end result you're aiming for?" maxlength="500"></textarea>
        <div class="counter" data-for="goal">0/500</div>
        <div class="quick-fills">
          <span class="quick-chip" onclick="fillGoal('Learn a new skill')">Learn skill</span>
          <span class="quick-chip" onclick="fillGoal('Complete a creative project')">Creative work</span>
          <span class="quick-chip" onclick="fillGoal('Improve my home')">Home improvement</span>
          <span class="quick-chip" onclick="fillGoal('Build something useful')">Build something</span>
        </div>
      </div>

      <div class="form-group">
        <label for="motivation">Motivation - Why is this important?</label>
        <textarea id="motivation" name="motivation" rows="2" 
                  placeholder="Why does this project matter to you?" maxlength="500"></textarea>
        <div class="counter" data-for="motivation">0/500</div>
        <div class="quick-fills">
          <span class="quick-chip" onclick="fillMotivation('Personal growth')">Growth</span>
          <span class="quick-chip" onclick="fillMotivation('Save money')">Financial</span>
          <span class="quick-chip" onclick="fillMotivation('Help others')">Service</span>
          <span class="quick-chip" onclick="fillMotivation('Fun and enjoyment')">Enjoyment</span>
        </div>
      </div>

      <div class="form-group">
        <label for="strategy">Strategy - How will you approach it?</label>
        <textarea id="strategy" name="strategy" rows="2" 
                  placeholder="What's your plan to make this happen?" maxlength="500"></textarea>
        <div class="counter" data-for="strategy">0/500</div>
        <div class="quick-fills">
          <span class="quick-chip" onclick="fillStrategy('Break into small daily tasks')">Daily tasks</span>
          <span class="quick-chip" onclick="fillStrategy('Set weekly milestones')">Weekly goals</span>
          <span class="quick-chip" onclick="fillStrategy('Research first, then execute')">Research first</span>
          <span class="quick-chip" onclick="fillStrategy('Learn by doing')">Learn by doing</span>
        </div>
      </div>
    </div>

    <!-- Action buttons -->
    <div class="form-actions">
      <button type="submit" class="btn btn-primary" style="min-width: 200px;">
        ‚ûï Create Project
      </button>
      <a href="{{ url_for('persprojects.index') }}" class="btn btn-outline">
        Cancel
      </a>
    </div>
  </form>
</div>

<script>
// Character counters
document.querySelectorAll('input[maxlength], textarea[maxlength]').forEach(field => {
  const counter = document.querySelector(`.counter[data-for="${field.id}"]`);
  if (counter) {
    // Update on input
    field.addEventListener('input', function() {
      counter.textContent = `${this.value.length}/${this.maxLength}`;
    });
    // Set initial value
    counter.textContent = `${field.value.length}/${field.maxLength}`;
  }
});

// Quick fill functions
function fillGoal(text) {
  const field = document.getElementById('goal');
  field.value = text;
  field.dispatchEvent(new Event('input'));
}

function fillMotivation(text) {
  const field = document.getElementById('motivation');
  field.value = text;
  field.dispatchEvent(new Event('input'));
}

function fillStrategy(text) {
  const field = document.getElementById('strategy');
  field.value = text;
  field.dispatchEvent(new Event('input'));
}

// Single submit guard
let isSubmitting = false;
document.getElementById('createProjectForm').addEventListener('submit', function(e) {
  if (isSubmitting) {
    e.preventDefault();
    return false;
  }
  isSubmitting = true;
  document.getElementById('submitBtn').disabled = true;
  document.getElementById('submitBtn').innerHTML = '‚è≥ Creating...';
});

// Date validation
document.getElementById('deadline').addEventListener('change', function() {
  const selectedDate = new Date(this.value);
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  if (selectedDate < today) {
    const hint = this.nextElementSibling;
    hint.textContent = '‚ö†Ô∏è This date is in the past';
    hint.style.color = 'var(--ap-danger)';
  } else {
    const hint = this.nextElementSibling;
    hint.textContent = 'Optional: When do you want to complete this?';
    hint.style.color = 'var(--ap-muted)';
  }
});
</script>
{% endblock %}