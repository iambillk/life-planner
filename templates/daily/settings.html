<!-- templates/daily/settings.html -->
{% extends "base.html" %}
{% block title %}Daily Planner Settings{% endblock %}
{% block header %}DRILL SERGEANT CONFIGURATION{% endblock %}

{% block extra_css %}
<style>
    .settings-container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .settings-section {
        background: var(--card);
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }
    
    .settings-section h3 {
        color: var(--primary);
        border-bottom: 2px solid var(--line);
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    
    .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: var(--panel);
        border-radius: 6px;
        margin-bottom: 10px;
    }
    
    .setting-label {
        flex: 1;
    }
    
    .setting-label h4 {
        margin: 0 0 5px 0;
        color: var(--text);
    }
    
    .setting-label small {
        color: var(--text-muted);
    }
    
    .setting-control {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .setting-value {
        background: var(--card);
        padding: 5px 10px;
        border-radius: 4px;
        min-width: 60px;
        text-align: center;
        font-weight: bold;
        color: var(--primary);
    }
    
    input[type="range"] {
        width: 150px;
    }
    
    input[type="number"] {
        width: 80px;
        background: var(--panel);
        border: 2px solid var(--line);
        color: var(--text);
        padding: 5px;
        border-radius: 4px;
    }
    
    select {
        background: var(--panel);
        border: 2px solid var(--line);
        color: var(--text);
        padding: 5px 10px;
        border-radius: 4px;
    }
    
    .harassment-preview {
        background: linear-gradient(135deg, #dc2626, #7f1d1d);
        color: white;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        font-weight: bold;
    }
    
    .custom-messages {
        margin-top: 20px;
    }
    
    .message-input {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
    }
    
    .message-input input {
        flex: 1;
        background: var(--panel);
        border: 2px solid var(--line);
        color: var(--text);
        padding: 8px;
        border-radius: 4px;
    }
    
    .message-list {
        background: var(--panel);
        padding: 10px;
        border-radius: 6px;
        max-height: 200px;
        overflow-y: auto;
    }
    
    .message-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px;
        margin: 5px 0;
        background: var(--card);
        border-radius: 4px;
    }
    
    .save-button {
        background: var(--success);
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 6px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        display: block;
        margin: 30px auto;
    }
    
    .danger-zone {
        background: rgba(239, 68, 68, 0.1);
        border: 2px solid var(--danger);
        padding: 20px;
        border-radius: 8px;
        margin-top: 30px;
    }
    
    .danger-zone h3 {
        color: var(--danger);
    }
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
    <form method="POST" action="{{ url_for('daily.save_settings') }}">
        
        <!-- Display Settings -->
        <div class="settings-section">
            <h3>üìä DISPLAY SETTINGS</h3>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Projects to Show Daily</h4>
                    <small>How many projects appear on your dashboard</small>
                </div>
                <div class="setting-control">
                    <input type="number" name="projects_to_show" 
                           value="{{ settings.projects_to_show }}" 
                           min="3" max="15">
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Default Calendar View</h4>
                    <small>Week or month view by default</small>
                </div>
                <div class="setting-control">
                    <select name="default_view">
                        <option value="week" {% if settings.default_view == 'week' %}selected{% endif %}>Week View</option>
                        <option value="month" {% if settings.default_view == 'month' %}selected{% endif %}>Month View</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Harassment Settings -->
        <div class="settings-section">
            <h3>üíÄ DRILL SERGEANT INTENSITY</h3>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Harassment Level</h4>
                    <small>How brutal should the motivation be?</small>
                </div>
                <div class="setting-control">
                    <select name="harassment_level" id="harassmentLevel" onchange="updatePreview()">
                        <option value="GENTLE" {% if settings.harassment_level == 'GENTLE' %}selected{% endif %}>Gentle Reminder</option>
                        <option value="FIRM" {% if settings.harassment_level == 'FIRM' %}selected{% endif %}>Firm Push</option>
                        <option value="BRUTAL" {% if settings.harassment_level == 'BRUTAL' %}selected{% endif %}>BRUTAL (Recommended)</option>
                        <option value="SAVAGE" {% if settings.harassment_level == 'SAVAGE' %}selected{% endif %}>SAVAGE MODE</option>
                    </select>
                </div>
            </div>
            
            <div class="harassment-preview" id="harassmentPreview">
                <!-- Preview will be updated by JavaScript -->
            </div>
        </div>
        
        <!-- Biological Maintenance Settings -->
        <div class="settings-section">
            <h3>üöø BIOLOGICAL THRESHOLDS</h3>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Shower Shame Threshold</h4>
                    <small>Days before the system starts shaming you</small>
                </div>
                <div class="setting-control">
                    <span class="setting-value" id="showerValue">{{ settings.shower_threshold_days }}</span>
                    <input type="range" name="shower_threshold_days" 
                           value="{{ settings.shower_threshold_days }}"
                           min="1" max="7" 
                           oninput="document.getElementById('showerValue').textContent = this.value">
                    <span>days</span>
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Morning Lockout Requirements</h4>
                    <small>How many morning tasks needed to unlock projects</small>
                </div>
                <div class="setting-control">
                    <select name="morning_lockout_tasks">
                        <option value="1" {% if settings.morning_lockout_tasks == '1' %}selected{% endif %}>1 of 3 tasks</option>
                        <option value="2" {% if settings.morning_lockout_tasks == '2' %}selected{% endif %}>2 of 3 tasks</option>
                        <option value="3" {% if settings.morning_lockout_tasks == '3' %}selected{% endif %}>All 3 tasks</option>
                    </select>
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Lockout Enforcement</h4>
                    <small>Can you bypass the morning lockout?</small>
                </div>
                <div class="setting-control">
                    <select name="lockout_enabled">
                        <option value="true" {% if settings.lockout_enabled == 'true' %}selected{% endif %}>Enforced (No Bypass)</option>
                        <option value="false" {% if settings.lockout_enabled == 'false' %}selected{% endif %}>Warning Only</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Time Settings -->
        <div class="settings-section">
            <h3>‚è∞ TIME SETTINGS</h3>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Evening Review Time</h4>
                    <small>When the evening review button appears</small>
                </div>
                <div class="setting-control">
                    <select name="evening_review_hour">
                        {% for hour in range(17, 23) %}
                        <option value="{{ hour }}" {% if settings.evening_review_hour == hour|string %}selected{% endif %}>
                            {{ hour }}:00 ({{ hour - 12 if hour > 12 else hour }} PM)
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Quiet Hours</h4>
                    <small>Reduce harassment during these hours</small>
                </div>
                <div class="setting-control">
                    <select name="quiet_start">
                        {% for hour in range(20, 24) %}
                        <option value="{{ hour }}" {% if settings.quiet_start == hour|string %}selected{% endif %}>
                            {{ hour }}:00
                        </option>
                        {% endfor %}
                    </select>
                    to
                    <select name="quiet_end">
                        {% for hour in range(5, 10) %}
                        <option value="{{ hour }}" {% if settings.quiet_end == hour|string %}selected{% endif %}>
                            {{ hour }}:00
                        </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Custom Messages -->
        <div class="settings-section">
            <h3>üí¨ CUSTOM HARASSMENT MESSAGES</h3>
            
            <div class="custom-messages">
                <div class="message-input">
                    <input type="text" id="newMessage" placeholder="Add your own motivational abuse...">
                    <button type="button" onclick="addMessage()" class="btn btn-primary">Add</button>
                </div>
                
                <div class="message-list" id="messageList">
                    {% for message in custom_messages %}
                    <div class="message-item">
                        <span>{{ message }}</span>
                        <button type="button" onclick="removeMessage(this)" class="btn btn-sm btn-danger">√ó</button>
                    </div>
                    {% endfor %}
                </div>
                
                <input type="hidden" name="custom_messages" id="customMessages" value="{{ custom_messages|join('|||') }}">
            </div>
        </div>
        
        <!-- Save Button -->
        <button type="submit" class="save-button">SAVE ALL SETTINGS</button>
        
        <!-- Danger Zone -->
        <div class="danger-zone">
            <h3>‚ö†Ô∏è DANGER ZONE</h3>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Reset All Settings</h4>
                    <small>Return to default brutal settings</small>
                </div>
                <div class="setting-control">
                    <button type="button" onclick="if(confirm('Reset all settings to defaults?')) window.location.href='{{ url_for('daily.reset_settings') }}'" 
                            class="btn btn-danger">Reset to Defaults</button>
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Clear All Daily Tasks</h4>
                    <small>Remove all tasks from today's dashboard</small>
                </div>
                <div class="setting-control">
                    <button type="button" onclick="if(confirm('Clear all daily tasks?')) window.location.href='{{ url_for('daily.clear_tasks') }}'" 
                            class="btn btn-danger">Clear Tasks</button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    function updatePreview() {
        const level = document.getElementById('harassmentLevel').value;
        const preview = document.getElementById('harassmentPreview');
        
        const messages = {
            'GENTLE': "Hey, don't forget to take your medications when you can.",
            'FIRM': "You need to take your medications now. This is important.",
            'BRUTAL': "TAKE YOUR MEDS NOW! Your brain is running on fumes!",
            'SAVAGE': "LISTEN UP MAGGOT! YOUR MEDS ARE 12 HOURS OVERDUE! YOUR BRAIN IS MUSH! TAKE THEM NOW OR STAY LOCKED OUT!"
        };
        
        preview.textContent = messages[level];
    }
    
    function addMessage() {
        const input = document.getElementById('newMessage');
        const message = input.value.trim();
        
        if (message) {
            const list = document.getElementById('messageList');
            const div = document.createElement('div');
            div.className = 'message-item';
            div.innerHTML = `
                <span>${message}</span>
                <button type="button" onclick="removeMessage(this)" class="btn btn-sm btn-danger">√ó</button>
            `;
            list.appendChild(div);
            input.value = '';
            updateHiddenField();
        }
    }
    
    function removeMessage(button) {
        button.parentElement.remove();
        updateHiddenField();
    }
    
    function updateHiddenField() {
        const messages = [];
        document.querySelectorAll('.message-item span').forEach(span => {
            messages.push(span.textContent);
        });
        document.getElementById('customMessages').value = messages.join('|||');
    }
    
    // Initialize preview on load
    updatePreview();
</script>
{% endblock %}