<!-- templates/daily/settings.html -->
{% extends "base.html" %}
{% block title %}Daily Planner Settings{% endblock %}
{% block header %}DRILL SERGEANT CONFIGURATION{% endblock %}

{% block extra_css %}
<style>
    .settings-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .settings-section {
        background: var(--card);
        border: 2px solid var(--line);
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 25px;
    }
    
    .settings-section h3 {
        color: var(--primary);
        border-bottom: 2px solid var(--line);
        padding-bottom: 12px;
        margin-bottom: 25px;
        font-size: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .setting-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 18px;
        background: var(--panel);
        border-radius: 8px;
        margin-bottom: 15px;
        border: 2px solid var(--line);
        transition: all 0.3s ease;
    }
    
    .setting-row:hover {
        border-color: var(--primary);
        transform: translateX(2px);
    }
    
    .setting-label {
        flex: 1;
    }
    
    .setting-label h4 {
        margin: 0 0 5px 0;
        color: var(--text);
        font-size: 16px;
    }
    
    .setting-label small {
        color: var(--text-muted);
        font-size: 13px;
    }
    
    .setting-control {
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .setting-value {
        background: var(--card);
        border: 2px solid var(--primary);
        padding: 6px 12px;
        border-radius: 6px;
        min-width: 60px;
        text-align: center;
        font-weight: bold;
        color: var(--primary);
        font-size: 14px;
    }
    
    input[type="range"] {
        width: 150px;
        cursor: pointer;
    }
    
    input[type="number"] {
        width: 80px;
        background: var(--panel);
        border: 2px solid var(--line);
        color: var(--text);
        padding: 6px;
        border-radius: 6px;
        font-size: 14px;
    }
    
    select {
        background: var(--panel);
        border: 2px solid var(--line);
        color: var(--text);
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
    }
    
    select:hover, input[type="number"]:hover {
        border-color: var(--primary);
    }
    
    .harassment-preview {
        background: linear-gradient(135deg, #dc2626, #7f1d1d);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-top: 25px;
        font-weight: bold;
        font-size: 16px;
        text-align: center;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.85; }
    }
    
    .custom-messages {
        margin-top: 25px;
    }
    
    .message-input {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .message-input input {
        flex: 1;
        background: var(--panel);
        border: 2px solid var(--line);
        color: var(--text);
        padding: 10px;
        border-radius: 6px;
        font-size: 14px;
    }
    
    .message-input input:focus {
        outline: none;
        border-color: var(--primary);
    }
    
    .add-message-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .add-message-btn:hover {
        background: var(--primary-hover);
        transform: translateY(-1px);
    }
    
    .message-list {
        background: var(--panel);
        padding: 15px;
        border-radius: 8px;
        max-height: 250px;
        overflow-y: auto;
        border: 2px solid var(--line);
    }
    
    .message-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px;
        margin: 5px 0;
        background: var(--card);
        border-radius: 6px;
        border: 1px solid var(--line);
    }
    
    .message-item:hover {
        border-color: var(--danger);
    }
    
    .delete-message {
        background: var(--danger);
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
    }
    
    .save-button {
        background: linear-gradient(135deg, var(--success), #16a34a);
        color: white;
        padding: 15px 40px;
        border: none;
        border-radius: 8px;
        font-size: 18px;
        font-weight: bold;
        cursor: pointer;
        display: block;
        margin: 30px auto;
        transition: all 0.3s ease;
    }
    
    .save-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
    }
    
    .danger-zone {
        background: rgba(239, 68, 68, 0.1);
        border: 2px solid var(--danger);
        padding: 25px;
        border-radius: 10px;
        margin-top: 30px;
    }
    
    .danger-zone h3 {
        color: var(--danger);
        border-color: var(--danger);
    }
    
    .danger-buttons {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .danger-btn {
        background: var(--danger);
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
    }
    
    .danger-btn:hover {
        background: #b91c1c;
        transform: translateY(-1px);
        color: white;
        text-decoration: none;
    }
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
    <form method="POST" action="{{ url_for('daily.save_settings') }}">
        
        <!-- Display Settings -->
        <div class="settings-section">
            <h3>
                <span>üìä</span>
                <span>DISPLAY SETTINGS</span>
            </h3>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Projects to Show Daily</h4>
                    <small>How many projects appear on your dashboard</small>
                </div>
                <div class="setting-control">
                    <span class="setting-value" id="projectsValue">{{ settings.projects_to_show }}</span>
                    <input type="range" name="projects_to_show" 
                           value="{{ settings.projects_to_show }}"
                           min="3" max="15" 
                           oninput="document.getElementById('projectsValue').textContent = this.value">
                    <span>projects</span>
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Default Calendar View</h4>
                    <small>Which view to show when opening calendar</small>
                </div>
                <div class="setting-control">
                    <select name="default_view">
                        <option value="week" {% if settings.default_view == 'week' %}selected{% endif %}>Week View</option>
                        <option value="month" {% if settings.default_view == 'month' %}selected{% endif %}>Month View</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Drill Sergeant Settings -->
        <div class="settings-section">
            <h3>
                <span>üò§</span>
                <span>DRILL SERGEANT INTENSITY</span>
            </h3>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Harassment Level</h4>
                    <small>How aggressive should the motivation be?</small>
                </div>
                <div class="setting-control">
                    <select name="harassment_level" id="harassmentLevel" onchange="updateHarassmentPreview()">
                        <option value="GENTLE" {% if settings.harassment_level == 'GENTLE' %}selected{% endif %}>üòä Gentle</option>
                        <option value="FIRM" {% if settings.harassment_level == 'FIRM' %}selected{% endif %}>üòê Firm</option>
                        <option value="BRUTAL" {% if settings.harassment_level == 'BRUTAL' %}selected{% endif %}>üò† Brutal</option>
                        <option value="SAVAGE" {% if settings.harassment_level == 'SAVAGE' %}selected{% endif %}>üî• Savage</option>
                    </select>
                </div>
            </div>
            
            <div class="harassment-preview" id="harassmentPreview">
                <!-- Preview updated by JavaScript -->
            </div>
        </div>
        
        <!-- Biological Maintenance Settings -->
        <div class="settings-section">
            <h3>
                <span>üöø</span>
                <span>BIOLOGICAL THRESHOLDS</span>
            </h3>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Shower Shame Threshold</h4>
                    <small>Days before the system starts shaming you</small>
                </div>
                <div class="setting-control">
                    <span class="setting-value" id="showerValue">{{ settings.shower_threshold_days }}</span>
                    <input type="range" name="shower_threshold_days" 
                           value="{{ settings.shower_threshold_days }}"
                           min="1" max="7" 
                           oninput="document.getElementById('showerValue').textContent = this.value">
                    <span>days</span>
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Morning Lockout Requirements</h4>
                    <small>How many morning tasks needed to unlock projects</small>
                </div>
                <div class="setting-control">
                    <select name="morning_lockout_tasks">
                        <option value="1" {% if settings.morning_lockout_tasks == '1' %}selected{% endif %}>1 of 3 tasks</option>
                        <option value="2" {% if settings.morning_lockout_tasks == '2' %}selected{% endif %}>2 of 3 tasks</option>
                        <option value="3" {% if settings.morning_lockout_tasks == '3' %}selected{% endif %}>All 3 tasks</option>
                    </select>
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Lockout Enforcement</h4>
                    <small>Can you bypass the morning lockout?</small>
                </div>
                <div class="setting-control">
                    <select name="lockout_enabled">
                        <option value="true" {% if settings.lockout_enabled == 'true' %}selected{% endif %}>Enforced (No Bypass)</option>
                        <option value="false" {% if settings.lockout_enabled == 'false' %}selected{% endif %}>Warning Only</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Time Settings -->
        <div class="settings-section">
            <h3>
                <span>‚è∞</span>
                <span>TIME SETTINGS</span>
            </h3>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Evening Review Start Time</h4>
                    <small>When does the evening review button appear?</small>
                </div>
                <div class="setting-control">
                    <select name="evening_review_hour">
                        <option value="17" {% if settings.evening_review_hour == '17' %}selected{% endif %}>5:00 PM</option>
                        <option value="18" {% if settings.evening_review_hour == '18' %}selected{% endif %}>6:00 PM</option>
                        <option value="19" {% if settings.evening_review_hour == '19' %}selected{% endif %}>7:00 PM</option>
                        <option value="20" {% if settings.evening_review_hour == '20' %}selected{% endif %}>8:00 PM</option>
                        <option value="21" {% if settings.evening_review_hour == '21' %}selected{% endif %}>9:00 PM</option>
                        <option value="22" {% if settings.evening_review_hour == '22' %}selected{% endif %}>10:00 PM</option>
                    </select>
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Evening Review End Time</h4>
                    <small>When does the evening review button disappear?</small>
                </div>
                <div class="setting-control">
                    <select name="evening_review_end_hour">
                        <option value="23" {% if settings.evening_review_end_hour == '23' %}selected{% endif %}>11:00 PM (Same Day)</option>
                        <option value="0" {% if settings.evening_review_end_hour == '0' %}selected{% endif %}>Midnight</option>
                        <option value="1" {% if settings.evening_review_end_hour == '1' %}selected{% endif %}>1:00 AM (Next Day)</option>
                        <option value="2" {% if settings.evening_review_end_hour == '2' %}selected{% endif %}>2:00 AM (Next Day)</option>
                        <option value="3" {% if settings.evening_review_end_hour == '3' %}selected{% endif %}>3:00 AM (Next Day)</option>
                        <option value="4" {% if settings.evening_review_end_hour == '4' %}selected{% endif %}>4:00 AM (Next Day)</option>
                        <option value="5" {% if settings.evening_review_end_hour == '5' %}selected{% endif %}>5:00 AM (Next Day)</option>
                        <option value="99" {% if settings.evening_review_end_hour == '99' %}selected{% endif %}>Never (Always Available)</option>
                    </select>
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Quiet Hours Start</h4>
                    <small>When to reduce harassment messages</small>
                </div>
                <div class="setting-control">
                    <select name="quiet_start">
                        <option value="20" {% if settings.quiet_start == '20' %}selected{% endif %}>8:00 PM</option>
                        <option value="21" {% if settings.quiet_start == '21' %}selected{% endif %}>9:00 PM</option>
                        <option value="22" {% if settings.quiet_start == '22' %}selected{% endif %}>10:00 PM</option>
                        <option value="23" {% if settings.quiet_start == '23' %}selected{% endif %}>11:00 PM</option>
                        <option value="0" {% if settings.quiet_start == '0' %}selected{% endif %}>Midnight</option>
                    </select>
                </div>
            </div>
            
            <div class="setting-row">
                <div class="setting-label">
                    <h4>Quiet Hours End</h4>
                    <small>When to resume normal harassment</small>
                </div>
                <div class="setting-control">
                    <select name="quiet_end">
                        <option value="5" {% if settings.quiet_end == '5' %}selected{% endif %}>5:00 AM</option>
                        <option value="6" {% if settings.quiet_end == '6' %}selected{% endif %}>6:00 AM</option>
                        <option value="7" {% if settings.quiet_end == '7' %}selected{% endif %}>7:00 AM</option>
                        <option value="8" {% if settings.quiet_end == '8' %}selected{% endif %}>8:00 AM</option>
                        <option value="9" {% if settings.quiet_end == '9' %}selected{% endif %}>9:00 AM</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Custom Messages -->
        <div class="settings-section">
            <h3>
                <span>üí¨</span>
                <span>CUSTOM HARASSMENT MESSAGES</span>
            </h3>
            
            <div class="custom-messages">
                <div class="message-input">
                    <input type="text" id="newMessage" placeholder="Add your own motivational threat...">
                    <button type="button" class="add-message-btn" onclick="addCustomMessage()">Add Message</button>
                </div>
                
                <div class="message-list" id="messageList">
                    {% for message in custom_messages %}
                    <div class="message-item">
                        <span>{{ message }}</span>
                        <button type="button" class="delete-message" onclick="deleteMessage(this)">Remove</button>
                    </div>
                    {% endfor %}
                </div>
                
                <input type="hidden" name="custom_messages" id="customMessages" value="{{ custom_messages|join('|||') }}">
            </div>
        </div>
        
        <!-- Save Button -->
        <button type="submit" class="save-button">
            üíæ SAVE ALL SETTINGS
        </button>
        
        <!-- Danger Zone -->
        <div class="settings-section danger-zone">
            <h3>
                <span>‚ö†Ô∏è</span>
                <span>DANGER ZONE</span>
            </h3>
            
            <div class="danger-buttons">
                <a href="{{ url_for('daily.reset_settings') }}" class="danger-btn" 
                   onclick="return confirm('This will reset ALL settings to defaults. Are you sure?')">
                    üîÑ Reset to Defaults
                </a>
                <a href="{{ url_for('daily.clear_tasks') }}" class="danger-btn"
                   onclick="return confirm('This will clear all daily tasks for today. Are you sure?')">
                    üóëÔ∏è Clear Today's Tasks
                </a>
            </div>
        </div>
        
    </form>
</div>

<script>
    // Update harassment preview based on level
    function updateHarassmentPreview() {
        const level = document.getElementById('harassmentLevel').value;
        const preview = document.getElementById('harassmentPreview');
        
        const messages = {
            'GENTLE': "Hey, don't forget to take your meds when you can! üòä",
            'FIRM': "You need to take your medications. This is important.",
            'BRUTAL': "TAKE YOUR MEDS NOW! Stop procrastinating!",
            'SAVAGE': "LISTEN UP MAGGOT! MEDS! NOW! NO EXCUSES!"
        };
        
        preview.textContent = messages[level] || messages['BRUTAL'];
    }
    
    // Custom message management
    function addCustomMessage() {
        const input = document.getElementById('newMessage');
        const message = input.value.trim();
        
        if (message) {
            const messageList = document.getElementById('messageList');
            const messageItem = document.createElement('div');
            messageItem.className = 'message-item';
            messageItem.innerHTML = `
                <span>${message}</span>
                <button type="button" class="delete-message" onclick="deleteMessage(this)">Remove</button>
            `;
            messageList.appendChild(messageItem);
            input.value = '';
            updateCustomMessagesField();
        }
    }
    
    function deleteMessage(button) {
        button.parentElement.remove();
        updateCustomMessagesField();
    }
    
    function updateCustomMessagesField() {
        const messages = [];
        document.querySelectorAll('.message-item span').forEach(span => {
            messages.push(span.textContent);
        });
        document.getElementById('customMessages').value = messages.join('|||');
    }
    
    // Initialize on load
    window.onload = function() {
        updateHarassmentPreview();
    }
    
    // Allow Enter key to add message
    document.getElementById('newMessage').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            addCustomMessage();
        }
    });
</script>
{% endblock %}