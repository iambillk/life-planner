{% extends "base.html" %}
{% block title %}Week Calendar{% endblock %}
{% block header %}WEEK VIEW{% endblock %}

{% block extra_css %}
<style>
  :root{
    --glow: 0 12px 34px rgba(0,0,0,.28);
    --glow-strong: 0 18px 50px rgba(0,0,0,.36);
  }
  .calendar-container{max-width:1400px;margin:0 auto;padding:20px 20px 64px;overflow-x:hidden}

  /* ======= TOP NAV (with centered legend inside) ======= */
  .calendar-nav{
    position:sticky;top:0;z-index:6;
    background: var(--panel);
    border:1px solid var(--line);border-radius:16px;padding:14px 16px 10px;margin-bottom:14px;
    box-shadow: var(--glow);backdrop-filter: blur(6px);
  }
  .nav-row{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
  .nav-buttons{display:flex;gap:10px;flex-wrap:wrap}
  .week-title{font-size:1.35rem;font-weight:800;color:var(--primary);text-align:center;letter-spacing:.2px;flex:1}

  .nav-btn{
    background: var(--card);color: var(--text);
    padding:11px 14px;border:1px solid var(--line);border-radius:10px;font-weight:800;
    text-decoration:none;display:inline-flex;align-items:center;gap:8px;transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease, filter .18s ease
  }
  .nav-btn:hover{transform:translateY(-2px);border-color:var(--primary);filter:brightness(1.03)}
  .nav-btn.warning{
    background:#f59e0b;color:#fff;border-color:#f59e0b;
    box-shadow:0 6px 18px rgba(245,158,11,.25);
  }
  .nav-btn.warning:hover{filter:brightness(1.05)}

  /* Dropdown */
  .dropdown{position:relative}
  .dropdown-toggle{cursor:pointer}
  .dropdown-menu{
    position:absolute;right:0;top:calc(100% + 6px);
    min-width:240px;background:var(--card);border:1px solid var(--line);border-radius:10px;
    padding:8px;display:none;box-shadow: var(--glow-strong);
  }
  .dropdown.open .dropdown-menu{display:block}
  .dropdown-item{
    display:flex;align-items:center;gap:8px;
    padding:10px 10px;border-radius:8px;text-decoration:none;color:var(--text);
    border:1px solid transparent;
  }
  .dropdown-item:hover{background:var(--panel);border-color:var(--line)}

  /* Legend INSIDE the nav, centered */
  .legend-wrap{display:flex;justify-content:center;margin-top:10px}
  .legend{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center}
  .legend-chip{
    display:inline-flex;align-items:center;gap:8px;
    background: var(--card);
    border:1px solid var(--line);
    color:var(--text);
    border-radius:999px;padding:8px 12px;font-weight:600;font-size:.92rem;
  }
  .legend-dot{width:10px;height:10px;border-radius:50%}
  .dot-me{background: var(--primary)}
  .dot-wife{background:#ec4899}
  .dot-kids{background:#10b981}
  .dot-family{background:#f59e0b}
  .dot-deadline{background:#ef4444}

  /* ======= WEEK STATS ======= */
  .week-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px;margin:18px 0}
  .stat-card{
    background:linear-gradient(180deg,color-mix(in oklab,var(--card) 96%, transparent), var(--card));
    border:1px solid var(--line);border-radius:14px;padding:14px;text-align:center;
    transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;box-shadow: var(--glow)
  }
  .stat-card:hover{transform:translateY(-2px);border-color:var(--primary)}
  .stat-number{font-size:1.9rem;font-weight:800;line-height:1;margin-bottom:6px;color:var(--text)}
  .stat-label{font-size:.78rem;color:var(--text-muted);letter-spacing:.4px;text-transform:uppercase}

  /* ======= WEEK GRID ======= */
  .week-grid{
    display:grid;grid-template-columns:repeat(7,minmax(0,1fr));
    gap:12px;margin-bottom:22px;
  }
  @media (max-width:1200px){.week-grid{grid-template-columns:repeat(4,minmax(0,1fr))}}
  @media (max-width:768px){.week-grid{grid-template-columns:1fr}}

  .day-column{
    background: var(--card);border:1px solid var(--line);border-radius:12px;padding:14px;min-height:360px;
    display:flex;flex-direction:column;transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;cursor:pointer;
    min-width:0;overflow:hidden;
  }
  .day-column:hover{transform:translateY(-2px);border-color:var(--primary);box-shadow: var(--glow)}
  .day-column.today{
    background: linear-gradient(180deg, color-mix(in oklab, var(--primary) 10%, transparent), var(--card));
    border-color: color-mix(in oklab, var(--primary) 60%, var(--line));
    box-shadow: 0 0 0 2px color-mix(in oklab, var(--primary) 45%, transparent), var(--glow-strong);
  }
  .day-column.weekend{background: linear-gradient(180deg, color-mix(in oklab, #10b981 8%, transparent), var(--card))}
  .day-header{text-align:center;padding-bottom:10px;margin-bottom:12px;border-bottom:1px solid var(--line);min-width:0}
  .day-name{font-size:1rem;font-weight:800;color:var(--primary);margin-bottom:3px}
  .day-date{font-size:.9rem;color:var(--text-muted)}
  .today-badge{display:inline-block;background:var(--success);color:#fff;padding:2px 8px;border-radius:12px;font-size:.62rem;font-weight:800;margin-top:6px;text-transform:uppercase}

  .events-container{flex:1;display:flex;flex-direction:column;gap:8px;overflow-y:auto;max-height:420px;min-width:0}
  .event-card{
    background: var(--panel);border-left:3px solid var(--primary);border-radius:8px;padding:10px;
    transition:transform .16s ease, box-shadow .16s ease;position:relative;min-width:0;
  }
  /* allow links to look like cards */
  .event-card, .modal-event { color:inherit; text-decoration:none; display:block; }
  .event-card:hover{transform:translateX(2px);box-shadow:0 6px 18px rgba(0,0,0,.18)}
  .event-card.wife{border-left-color:#ec4899;background:linear-gradient(to right, rgba(236,72,153,.1), var(--panel))}
  .event-card.kids{border-left-color:#10b981;background:linear-gradient(to right, rgba(16,185,129,.1), var(--panel))}
  .event-card.family{border-left-color:#f59e0b;background:linear-gradient(to right, rgba(245,158,11,.1), var(--panel))}
  .event-card.deadline{border-left-color:#ef4444;background:linear-gradient(to right, rgba(239,68,68,.15), var(--panel))}

  .event-time{font-size:.72rem;font-weight:800;color:var(--primary);margin-bottom:4px;min-width:0}
  .event-title{
    font-size:.92rem;font-weight:800;color:var(--text);margin-bottom:2px;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0;overflow-wrap:anywhere;
  }
  .event-description{
    font-size:.83rem;color:var(--text-muted);margin-top:4px;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0;overflow-wrap:anywhere;
  }
  .event-who{display:inline-block;font-size:.65rem;padding:2px 6px;border-radius:6px;font-weight:800;margin-top:6px;text-transform:uppercase}
  .event-who.me{background:var(--primary);color:#fff}
  .event-who.wife{background:#ec4899;color:#fff}
  .event-who.kids,.event-who.ziggy,.event-who.gus{background:#10b981;color:#fff}
  .event-who.family{background:#f59e0b;color:#fff}
  .no-events{text-align:center;color:var(--text-muted);font-style:italic;padding:14px;font-size:.84rem}

  /* Modal */
  .modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:999;animation:fadeIn .2s ease}
  .modal-overlay.show{display:block}
  .day-modal{
    display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
    background: var(--card);border:1px solid var(--line);border-radius:16px;padding:22px;
    max-width:680px;width:92%;max-height:76vh;overflow:auto;z-index:1000;animation:slideIn .25s ease;box-shadow: var(--glow-strong)
  }
  .day-modal.show{display:block}
  .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;padding-bottom:12px;border-bottom:1px solid var(--line)}
  .modal-title{font-size:1.25rem;font-weight:800;color:var(--primary)}
  .close-btn{background:none;border:none;font-size:1.8rem;color:var(--text-muted);cursor:pointer;transition:color .18s ease}
  .close-btn:hover{color:var(--danger)}
  .modal-events{display:flex;flex-direction:column;gap:10px;max-height:52vh;overflow:auto}

  .modal-event{background: var(--panel);padding:12px;border-radius:10px;border-left:4px solid var(--primary);position:relative;transition:transform .16s ease, box-shadow .16s ease;min-width:0}
  .modal-event:hover{transform:translateX(2px);box-shadow:0 6px 18px rgba(0,0,0,.18)}
  .modal-event.wife{border-left-color:#ec4899}
  .modal-event.kids,.modal-event.ziggy,.modal-event.gus{border-left-color:#10b981}
  .modal-event.family{border-left-color:#f59e0b}
  .modal-event.deadline{border-left-color:#ef4444}
  .modal-event .row{display:flex;gap:6px;align-items:center;min-width:0}
  .modal-event .title{flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;overflow-wrap:anywhere}

  .event-actions{position:absolute;top:8px;right:8px;display:flex;gap:6px;opacity:0;transition:opacity .18s ease}
  .modal-event:hover .event-actions{opacity:1}
  .event-action-btn{background: var(--card);border:1px solid var(--line);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:.8rem;color:var(--text);text-decoration:none;transition:transform .16s ease, filter .16s ease}
  .event-action-btn:hover{transform:scale(1.06)}
  .event-action-btn.edit{color:var(--primary)}
  .event-action-btn.delete{color:var(--danger)}

  .modal-actions{margin-top:16px;padding-top:12px;border-top:1px solid var(--line);display:flex;gap:10px;justify-content:center}
  .modal-btn{padding:10px 16px;border-radius:10px;font-weight:800;cursor:pointer;transition:transform .16s ease;text-decoration:none;border:none;background:var(--panel);color:var(--text)}
  .modal-btn:hover{transform:translateY(-1px)}
  .modal-btn.primary{background:var(--primary);color:#fff}
  .modal-btn.primary:hover{filter:brightness(1.05)}
  .no-events-message{text-align:center;color:var(--text-muted);padding:18px;font-style:italic}

  @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  @keyframes slideIn{from{opacity:0;transform:translate(-50%,-45%)}to{opacity:1;transform:translate(-50%,-50%)}}
  @media (prefers-reduced-motion:reduce){.nav-btn,.day-column,.modal-event{transition:none}}
</style>
{% endblock %}

{% block content %}
<div class="calendar-container">

  <!-- NAVIGATION (legend inside this box) -->
  <div class="calendar-nav" id="topNav">
    <div class="nav-row">
      <!-- LEFT -->
      <div class="nav-buttons">
        <a href="{{ url_for('daily.calendar_view', view='week', week_offset=week_offset-1) }}" class="nav-btn" id="btnPrev">‚Üê Previous</a>
        <a href="{{ url_for('daily.calendar_view', view='week', week_offset=week_offset+1) }}" class="nav-btn" id="btnNext">Next ‚Üí</a>
        <a href="{{ url_for('daily.calendar_view', view='week') }}" class="nav-btn">‚ö° Today</a>
      </div>

      <!-- CENTER -->
      <div class="week-title">
        {{ week_start.strftime('%B %d') }} - {{ week_end.strftime('%B %d, %Y') }}
      </div>

      <!-- RIGHT -->
      <div class="nav-buttons">
        <a href="{{ url_for('daily.calendar_analytics') }}" class="nav-btn">üìä Analytics</a>
        <a href="javascript:void(0)" class="nav-btn warning" onclick="checkTimeTree()">üì± Check TimeTree</a>

        <div class="dropdown" id="moreMenu">
          <a class="nav-btn dropdown-toggle" onclick="toggleDropdown(event)">‚ãØ More ‚ñæ</a>
          <div class="dropdown-menu" role="menu" aria-label="More">
            <a class="dropdown-item" href="{{ url_for('daily.calendar_view', view='month', month=week_start.strftime('%Y-%m')) }}">üìÖ Month View</a>
            <a class="dropdown-item" href="{{ url_for('daily.add_event') }}">‚ûï Add Event</a>
            <a class="dropdown-item" href="{{ url_for('daily.index') }}">‚Üê Back to Dashboard</a>
          </div>
        </div>
      </div>
    </div>

    <!-- LEGEND centered -->
    <div class="legend-wrap">
      <div class="legend">
        <span class="legend-chip"><span class="legend-dot dot-me"></span> Me</span>
        <span class="legend-chip"><span class="legend-dot dot-wife"></span> Wife</span>
        <span class="legend-chip"><span class="legend-dot dot-kids"></span> Kids</span>
        <span class="legend-chip"><span class="legend-dot dot-family"></span> Family</span>
        <span class="legend-chip"><span class="legend-dot dot-deadline"></span> Deadline</span>
      </div>
    </div>
  </div>

  <!-- WEEK STATS -->
  <div class="week-stats">
    <div class="stat-card">
      <div class="stat-number">{{ events_by_day.values()|map('length')|sum }}</div>
      <div class="stat-label">Total Events</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">
        {% set my_events = namespace(count=0) %}
        {% for day_events in events_by_day.values() %}
          {% for event in day_events if event.who == 'Me' %}
            {% set my_events.count = my_events.count + 1 %}
          {% endfor %}
        {% endfor %}
        {{ my_events.count }}
      </div>
      <div class="stat-label">Your Events</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">
        {% set wife_events = namespace(count=0) %}
        {% for day_events in events_by_day.values() %}
          {% for event in day_events if event.who == 'Wife' %}
            {% set wife_events.count = wife_events.count + 1 %}
          {% endfor %}
        {% endfor %}
        {{ wife_events.count }}
      </div>
      <div class="stat-label">Wife's Events</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">
        {% set kid_events = namespace(count=0) %}
        {% for day_events in events_by_day.values() %}
          {% for event in day_events if event.who in ['Ziggy', 'Gus'] %}
            {% set kid_events.count = kid_events.count + 1 %}
          {% endfor %}
        {% endfor %}
        {{ kid_events.count }}
      </div>
      <div class="stat-label">Kid Events</div>
    </div>
    <div class="stat-card">
      <div class="stat-number">{{ (tch_deadlines|length) + (personal_deadlines|length) }}</div>
      <div class="stat-label">Deadlines</div>
    </div>
  </div>

  <!-- WEEK GRID (Sunday-first) -->
  {% set sunday_start = week_start - timedelta(days=(week_start.weekday() + 1) % 7) %}
  <div class="week-grid">
    {% for i in range(7) %}
      {% set day_date = sunday_start + timedelta(days=i) %}
      {% set is_today = day_date == today %}
      {% set is_weekend = day_date.weekday() in [5, 6] %}

      <div class="day-column {% if is_today %}today{% endif %} {% if is_weekend %}weekend{% endif %}"
           onclick="showDayDetails('{{ day_date.strftime('%Y-%m-%d') }}')">

        <div class="day-header">
          <div class="day-name">{{ day_date.strftime('%A') }}</div>
          <div class="day-date">{{ day_date.strftime('%B %d') }}</div>
          {% if is_today %}<div class="today-badge">TODAY</div>{% endif %}
        </div>

        <div class="events-container">
          <!-- Deadlines first -->
          {% for project in tch_deadlines if project.deadline == day_date %}
          <a class="event-card deadline" 
             href="{{ url_for('projects.tch_detail', id=project.id) }}" 
             onclick="event.stopPropagation()" title="Open project">
            <div class="event-title" style="color:#ef4444;font-weight:800">‚ö†Ô∏è DEADLINE: {{ project.name|truncate(30) }}</div>
            <span class="event-who" style="background:#ef4444;color:#fff">TCH Project</span>
          </a>
          {% endfor %}

          {% for project in personal_deadlines if project.deadline == day_date %}
          <a class="event-card deadline" 
             href="{{ url_for('persprojects.detail', id=project.id) }}" 
             onclick="event.stopPropagation()" title="Open project">
            <div class="event-title" style="color:#ef4444;font-weight:800">‚ö†Ô∏è DEADLINE: {{ project.name|truncate(30) }}</div>
            <span class="event-who" style="background:#ef4444;color:#fff">Personal</span>
          </a>
          {% endfor %}

          <!-- Regular events -->
          {% set events = events_by_day.get(day_date, []) %}
          {% if events %}
            {% for event in events %}
            <div class="event-card {% if event.who == 'Wife' %}wife{% elif event.who in ['Ziggy','Gus'] %}kids{% elif event.who == 'Family' %}family{% endif %}">
              {% if event.event_time %}<div class="event-time">{{ event.event_time }}</div>{% endif %}
              <div class="event-title">{{ event.event_type }}</div>
              {% if event.description %}<div class="event-description">{{ event.description|truncate(60) }}</div>{% endif %}
              <span class="event-who {{ event.who|lower|replace(' ', '-') }}">{{ event.who }}</span>
            </div>
            {% endfor %}
          {% else %}
            {% if not (tch_deadlines|selectattr('deadline','equalto',day_date)|list or personal_deadlines|selectattr('deadline','equalto',day_date)|list) %}
              <div class="no-events">No events scheduled</div>
            {% endif %}
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<!-- DAY DETAILS MODAL -->
<div class="modal-overlay" id="modalOverlay" onclick="closeDayModal()"></div>
<div class="day-modal" id="dayModal" role="dialog" aria-modal="true" aria-labelledby="modalDate">
  <div class="modal-header">
    <h3 class="modal-title" id="modalDate">Date</h3>
    <button class="close-btn" onclick="closeDayModal()" aria-label="Close">√ó</button>
  </div>
  <div class="modal-events" id="modalContent"></div>
  <div class="modal-actions">
    <button class="modal-btn primary" id="addEventBtn">‚ûï Add Event</button>
    <button class="modal-btn" onclick="closeDayModal()">Close</button>
  </div>
</div>

<!-- Hidden form for delete -->
<form id="deleteForm" method="POST" style="display:none">
  <input type="hidden" name="return_to" value="calendar">
  <input type="hidden" name="delete_all_recurring" id="deleteAllRecurring" value="no">
</form>
{% endblock %}

{% block extra_js %}
<script>
  let currentDayEvents = [];

  // Route bases used in modal links (adjust the tch_detail endpoint name if different)
  const ROUTE_BASE = {
    tch: "{{ url_for('projects.tch_detail', id=0) }}".replace(/0$/, ''),
    personal: "{{ url_for('persprojects.detail', id=0) }}".replace(/0$/, '')
  };

  function toggleDropdown(e){
    e.stopPropagation();
    document.getElementById('moreMenu').classList.toggle('open');
  }
  document.addEventListener('click', ()=> {
    document.getElementById('moreMenu')?.classList.remove('open');
  });

  function showDayDetails(dateStr){
    const date = new Date(dateStr);
    const options = { weekday:'long', year:'numeric', month:'long', day:'numeric' };
    document.getElementById('modalDate').textContent = date.toLocaleDateString('en-US', options);

    document.getElementById('addEventBtn').onclick = function(){
      window.location.href = `{{ url_for('daily.add_event') }}?date=${dateStr}`;
    };

    fetch(`{{ url_for('daily.api_get_events', date_str='') }}${dateStr}`)
      .then(r => r.json())
      .then(data => {
        currentDayEvents = (data && data.events) ? data.events : [];
        const content = document.getElementById('modalContent');
        content.innerHTML = '';

        const hasEvents = data && Array.isArray(data.events) && data.events.length > 0;
        const hasDeadlines = data && Array.isArray(data.deadlines) && data.deadlines.length > 0;

        if (!hasEvents && !hasDeadlines){
          content.innerHTML = '<div class="no-events-message">No events scheduled for this day</div>';
        } else {
          if (hasDeadlines){
            data.deadlines.forEach(d => {
              // Expecting d like { id, name, priority, kind: 'tch'|'personal' }
              const href = (d && d.id && d.kind && ROUTE_BASE[d.kind]) ? (ROUTE_BASE[d.kind] + d.id) : null;

              const wrapper = document.createElement(href ? 'a' : 'div');
              wrapper.className = 'modal-event deadline';
              if (href) {
                wrapper.href = href;
                wrapper.target = '_self';
                wrapper.title = 'Open project';
              }

              wrapper.innerHTML = `
                <div class="row">
                  <span class="title" style="font-weight:700;color:#ef4444">
                    ‚ö†Ô∏è DEADLINE: ${d.name}
                  </span>
                </div>
                <div style="font-size:14px;color:var(--text-muted)">Priority: ${d.priority || 'Medium'}</div>
              `;
              content.appendChild(wrapper);
            });
          }
          if (hasEvents){
            data.events.forEach(event => {
              const whoClass = (event.who||'').toLowerCase().replace(' ','-');
              const el = document.createElement('div');
              el.className = `modal-event ${whoClass}`;
              const safeTime = (event.time || 'All Day');
              const safeType = (event.type || '');
              el.innerHTML = `
                <div class="event-actions">
                  <a href="/daily/events/${event.id}/edit?return_to=calendar" class="event-action-btn edit" title="Edit">‚úèÔ∏è</a>
                  <button class="event-action-btn delete" onclick="quickDeleteEvent(${event.id})" title="Delete">üóëÔ∏è</button>
                </div>
                <div class="row" style="font-weight:700;margin-bottom:4px;">
                  <span class="title">${safeTime} - ${safeType}${event.is_recurring ? '<span style="color:var(--info);margin-left:8px;">‚Üª Recurring</span>' : ''}</span>
                </div>
                <div style="font-size:14px;color:var(--text-muted)">Who: ${event.who||'‚Äî'}</div>
                ${event.description ? `<div style="font-size:13px;margin-top:6px;color:var(--text)">${event.description}</div>` : ''}
              `;
              content.appendChild(el);
            });
          }
        }
      })
      .catch(err => {
        console.error('Error fetching events:', err);
        document.getElementById('modalContent').innerHTML =
          '<div class="no-events-message" style="color:var(--danger)">Error loading events</div>';
      });

    document.getElementById('modalOverlay').classList.add('show');
    document.getElementById('dayModal').classList.add('show');
  }

  function closeDayModal(){
    document.getElementById('modalOverlay').classList.remove('show');
    document.getElementById('dayModal').classList.remove('show');
  }

  function quickDeleteEvent(eventId){
    const event = currentDayEvents.find(e => e.id === eventId);
    let confirmMsg = 'Are you sure you want to delete this event?';
    if (event && event.is_recurring){
      if (confirm('This is a recurring event.\n\nClick OK to delete ALL future occurrences\nClick Cancel to delete only this instance')){
        document.getElementById('deleteAllRecurring').value = 'yes';
        confirmMsg = 'Delete ALL future occurrences of this event?';
      } else {
        document.getElementById('deleteAllRecurring').value = 'no';
        confirmMsg = 'Delete only this instance?';
      }
    }
    if (confirm(confirmMsg)){
      fetch(`{{ url_for('daily.quick_delete_event', event_id=0) }}`.replace('0', eventId), {
        method:'POST', headers:{'Content-Type':'application/json'}
      })
      .then(r => r.json())
      .then(data => { if (data.success){ location.reload(); } else { alert('Failed to delete event'); }})
      .catch(err => { console.error('Error:', err); alert('Failed to delete event'); });
    }
  }

  function checkTimeTree(){
    if (confirm('üì± Open TimeTree App?\n\nThis will redirect you to TimeTree for family calendar sync.')){
      window.open('https://timetreeapp.com', '_blank');
    }
  }

  // Keyboard: left/right for nav, Escape to close modal
  document.addEventListener('keydown', (e)=>{
    const modalOpen = document.getElementById('dayModal').classList.contains('show');
    if (e.key === 'Escape' && modalOpen) closeDayModal();
    if (!modalOpen){
      if (e.key === 'ArrowLeft'){ document.getElementById('btnPrev')?.click(); }
      if (e.key === 'ArrowRight'){ document.getElementById('btnNext')?.click(); }
    }
  });
</script>
{% endblock %}
