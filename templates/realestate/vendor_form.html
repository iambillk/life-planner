{# =============================================================================
  FILE: templates/realestate/vendor_form.html
  PURPOSE: Real Estate — Add/Edit Vendor & Neighbors for a Property
  TEMPLATE VERSION: v1.1.3
  LAST UPDATED: 2025-09-05

  Changelog
  v1.1.3
  - Bulletproof red delete: high-specificity + !important on .kbtn.kbtn-danger
  - Keeps all links rendered as buttons (anchors/labels too)

  v1.1.2
  - Added solid red delete, moved to formaction/formmethod

  v1.1.0
  - Renamed UI copy to “Vendor & Neighbors”, added Delete button

  v1.0.0
  - Card layout, sticky action bar, Ctrl/Cmd+Enter submit, responsive fields
============================================================================= #}

{% extends "base.html" %}
{% block title %}{{ 'Edit' if vendor else 'Add' }} Vendor & Neighbors — {{ property.name }}{% endblock %}
{% set active = 'realestate' %}
{% block header %}{{ 'Edit' if vendor else 'Add' }} Vendor & Neighbors — {{ property.name }}{% endblock %}

{% block content %}
<form method="POST"
      class="kcard vendor-form"
      style="display:grid;gap:14px;max-width:820px;">

  <!-- Header -->
  <div class="kcard-head" style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
      <h2 class="kcard-title" style="margin:0;">{{ 'Edit Vendor & Neighbors' if vendor else 'Add Vendor & Neighbors' }}</h2>
      <span class="kchip">Property: <strong>{{ property.name }}</strong></span>
      {% if vendor and vendor.service_type %}<span class="kchip">{{ vendor.service_type }}</span>{% endif %}
    </div>
    <div class="kcard-actions" style="display:flex;gap:8px;">
      <a class="kbtn kbtn-ghost" href="{{ url_for('realestate.property_detail', id=property.id) }}">← Back</a>
    </div>
  </div>

  <!-- Fields -->
  <section class="ksection">
    <h3 class="ksection-title">Vendor & Neighbor Details</h3>

    <div class="kfield">
      <label for="company_name">Company Name <span class="req">*</span></label>
      <input type="text" id="company_name" name="company_name" value="{{ vendor.company_name if vendor else '' }}" required placeholder="e.g., Northwoods Plumbing Co.">
      <div class="khint">Exact company name for matching across properties.</div>
    </div>

    <div class="kfield">
      <label for="service_type">Service Type</label>
      <input type="text" id="service_type" name="service_type" value="{{ vendor.service_type if vendor else '' }}" placeholder="Plumbing, Electrical, Landscaping…">
      <div class="khint">Used for filters and reporting.</div>
    </div>

    <div class="grid-2">
      <div class="kfield">
        <label for="phone">Phone</label>
        <input type="text" id="phone" name="phone" value="{{ vendor.phone if vendor else '' }}" placeholder="(555) 123-4567">
      </div>
      <div class="kfield">
        <label for="email">Email</label>
        <input type="email" id="email" name="email" value="{{ vendor.email if vendor else '' }}" placeholder="vendor@example.com">
      </div>
    </div>

    <div class="kfield">
      <label for="notes">Notes</label>
      <textarea id="notes" name="notes" rows="4" placeholder="Point of contact, rates, warranty terms, scheduling notes…">{{ vendor.notes if vendor else '' }}</textarea>
    </div>
  </section>

  <!-- Sticky Action Bar -->
  <div class="actionbar">
    <div class="actionbar-inner">
      <div class="keys-hint">Press <kbd>Ctrl</kbd>/<kbd>⌘</kbd> + <kbd>Enter</kbd> to Save</div>
      <div class="actions" style="display:flex;gap:8px;align-items:center;width:100%;">
        <a href="{{ url_for('realestate.property_detail', id=property.id) }}" class="kbtn">Cancel</a>

        <button type="submit" class="kbtn kbtn-primary">
          {{ 'Save Changes' if vendor else 'Save Vendor & Neighbor' }}
        </button>

        {% if vendor %}
        <button type="submit"
                class="kbtn kbtn-danger"
                style="margin-left:auto;"
                formmethod="post"
                formaction="{{ url_for('realestate.delete_vendor', property_id=property.id, vendor_id=vendor.id) }}"
                onclick="return confirm('Delete this vendor/neighbor from this property? This cannot be undone.');">
          Delete
        </button>
        {% endif %}
      </div>
    </div>
  </div>

  <details class="kaccordion">
    <summary>Form Info & Changelog</summary>
    <div class="kcard-body">
      <ul>
        <li><strong>Template:</strong> vendor_form.html — v1.1.3</li>
        <li><strong>Last Updated:</strong> 2025-09-05</li>
      </ul>
    </div>
  </details>
</form>
{% endblock %}

{% block extra_css %}
<style>
  .kcard-head{padding-bottom:6px;border-bottom:1px solid var(--line);}
  .ksection{display:grid;gap:12px}
  .ksection-title{font-weight:700;margin:6px 0}
  .kfield label{display:block;margin-bottom:6px;color:var(--text-muted)}
  .kfield input[type="text"], .kfield input[type="email"], .kfield textarea{
    width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:rgba(255,255,255,0.02);color:var(--text)
  }
  .kfield textarea{resize:vertical;min-height:120px}
  .grid-2{display:grid;gap:12px;grid-template-columns:repeat(2, minmax(0,1fr));}
  @media (max-width: 900px){ .grid-2{grid-template-columns:1fr;} }

  .actionbar{position:sticky;bottom:0;z-index:5;margin-top:4px;}
  .actionbar-inner{border:1px solid var(--line);border-radius:12px;background:rgba(10,15,26,.75);backdrop-filter:blur(6px);padding:10px 12px;display:flex;justify-content:space-between;align-items:center;gap:12px}
  .keys-hint{color:var(--text-muted);font-size:.9rem}
  kbd{border:1px solid var(--line);border-bottom-color:rgba(255,255,255,0.25);border-radius:6px;padding:2px 6px;font-family:ui-monospace, SFMono-Regular, Menlo, monospace;background:rgba(255,255,255,0.06)}

  /* Buttonize anchors/labels and base button look */
  .kbtn, a.kbtn, label.kbtn{
    display:inline-flex;align-items:center;justify-content:center;gap:8px;
    padding:8px 12px;border-radius:10px;border:1px solid var(--line);
    background:rgba(255,255,255,0.03);color:var(--text);text-decoration:none;
    cursor:pointer;user-select:none;transition:transform .08s ease,border-color .15s ease,background .15s ease;font-size:.95rem;
  }
  .kbtn:hover, a.kbtn:hover, label.kbtn:hover{ transform:translateY(-1px); border-color:var(--primary, #6ea8ff); }
  .kbtn-ghost{ background:transparent; }
  .kbtn-primary{ background:rgba(110,168,255,.18); border-color:rgba(110,168,255,.55); }

  /* ===== Bulletproof RED delete button (beats base styles) ===== */
  .kbtn.kbtn-danger,
  a.kbtn.kbtn-danger,
  button.kbtn.kbtn-danger{
    background:#ef4444 !important;
    border-color:#ef4444 !important;
    color:#ffffff !important;
  }
  .kbtn.kbtn-danger:hover,
  a.kbtn.kbtn-danger:hover,
  button.kbtn.kbtn-danger:hover{
    filter:brightness(1.08); transform:translateY(-1px);
  }
  .kbtn.kbtn-danger:focus-visible{ outline:2px solid #fecaca; outline-offset:2px; }
</style>
{% endblock %}

{% block extra_js %}
<script>
  (function(){
    const form = document.querySelector('.vendor-form');
    form.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') form.requestSubmit();
    });
  })();
</script>
{% endblock %}
